import { bind } from 'angular2/src/core/di';
import { ListWrapper, StringMapWrapper } from 'angular2/src/facade/collection';
import { Json, isPresent, isBlank, StringWrapper, NumberWrapper } from 'angular2/src/facade/lang';
import { BaseException } from 'angular2/src/facade/exceptions';
import { WebDriverExtension, PerfLogFeatures } from '../web_driver_extension';
import { WebDriverAdapter } from '../web_driver_adapter';
import { Options } from '../common_options';
/**
 * Set the following 'traceCategories' to collect metrics in Chrome:
 * 'v8,blink.console,disabled-by-default-devtools.timeline,devtools.timeline'
 *
 * In order to collect the frame rate related metrics, add 'benchmark'
 * to the list above.
 */
export class ChromeDriverExtension extends WebDriverExtension {
    constructor(_driver, userAgent) {
        super();
        this._driver = _driver;
        this._majorChromeVersion = this._parseChromeVersion(userAgent);
    }
    // TODO(tbosch): use static values when our transpiler supports them
    static get BINDINGS() { return _PROVIDERS; }
    _parseChromeVersion(userAgent) {
        if (isBlank(userAgent)) {
            return -1;
        }
        var v = StringWrapper.split(userAgent, /Chrom(e|ium)\//g)[2];
        if (isBlank(v)) {
            return -1;
        }
        v = v.split('.')[0];
        if (isBlank(v)) {
            return -1;
        }
        return NumberWrapper.parseInt(v, 10);
    }
    gc() { return this._driver.executeScript('window.gc()'); }
    timeBegin(name) {
        return this._driver.executeScript(`console.time('${name}');`);
    }
    timeEnd(name, restartName = null) {
        var script = `console.timeEnd('${name}');`;
        if (isPresent(restartName)) {
            script += `console.time('${restartName}');`;
        }
        return this._driver.executeScript(script);
    }
    // See [Chrome Trace Event
    // Format](https://docs.google.com/document/d/1CvAClvFfyA5R-PhYUmn5OOQtYMH4h6I0nSsKchNAySU/edit)
    readPerfLog() {
        // TODO(tbosch): Chromedriver bug https://code.google.com/p/chromedriver/issues/detail?id=1098
        // Need to execute at least one command so that the browser logs can be read out!
        return this._driver.executeScript('1+1')
            .then((_) => this._driver.logs('performance'))
            .then((entries) => {
            var events = [];
            entries.forEach(entry => {
                var message = Json.parse(entry['message'])['message'];
                if (StringWrapper.equals(message['method'], 'Tracing.dataCollected')) {
                    events.push(message['params']);
                }
                if (StringWrapper.equals(message['method'], 'Tracing.bufferUsage')) {
                    throw new BaseException('The DevTools trace buffer filled during the test!');
                }
            });
            return this._convertPerfRecordsToEvents(events);
        });
    }
    _convertPerfRecordsToEvents(chromeEvents, normalizedEvents = null) {
        if (isBlank(normalizedEvents)) {
            normalizedEvents = [];
        }
        var majorGCPids = {};
        chromeEvents.forEach((event) => {
            var categories = this._parseCategories(event['cat']);
            var name = event['name'];
            if (this._isEvent(categories, name, ['blink.console'])) {
                normalizedEvents.push(normalizeEvent(event, { 'name': name }));
            }
            else if (this._isEvent(categories, name, ['benchmark'], 'BenchmarkInstrumentation::ImplThreadRenderingStats')) {
                // TODO(goderbauer): Instead of BenchmarkInstrumentation::ImplThreadRenderingStats the
                // following events should be used (if available) for more accurate measurments:
                //   1st choice: vsync_before - ground truth on Android
                //   2nd choice: BenchmarkInstrumentation::DisplayRenderingStats - available on systems with
                //               new surfaces framework (not broadly enabled yet)
                //   3rd choice: BenchmarkInstrumentation::ImplThreadRenderingStats - fallback event that is
                //               always available if something is rendered
                var frameCount = event['args']['data']['frame_count'];
                if (frameCount > 1) {
                    throw new BaseException('multi-frame render stats not supported');
                }
                if (frameCount == 1) {
                    normalizedEvents.push(normalizeEvent(event, { 'name': 'frame' }));
                }
            }
            else if (this._isEvent(categories, name, ['disabled-by-default-devtools.timeline'], 'Rasterize') ||
                this._isEvent(categories, name, ['disabled-by-default-devtools.timeline'], 'CompositeLayers')) {
                normalizedEvents.push(normalizeEvent(event, { 'name': 'render' }));
            }
            else if (this._majorChromeVersion < 45) {
                var normalizedEvent = this._processAsPreChrome45Event(event, categories, majorGCPids);
                if (normalizedEvent != null)
                    normalizedEvents.push(normalizedEvent);
            }
            else {
                var normalizedEvent = this._processAsPostChrome44Event(event, categories);
                if (normalizedEvent != null)
                    normalizedEvents.push(normalizedEvent);
            }
        });
        return normalizedEvents;
    }
    _processAsPreChrome45Event(event, categories, majorGCPids) {
        var name = event['name'];
        var args = event['args'];
        var pid = event['pid'];
        var ph = event['ph'];
        if (this._isEvent(categories, name, ['disabled-by-default-devtools.timeline'], 'FunctionCall') &&
            (isBlank(args) || isBlank(args['data']) ||
                !StringWrapper.equals(args['data']['scriptName'], 'InjectedScript'))) {
            return normalizeEvent(event, { 'name': 'script' });
        }
        else if (this._isEvent(categories, name, ['disabled-by-default-devtools.timeline'], 'RecalculateStyles') ||
            this._isEvent(categories, name, ['disabled-by-default-devtools.timeline'], 'Layout') ||
            this._isEvent(categories, name, ['disabled-by-default-devtools.timeline'], 'UpdateLayerTree') ||
            this._isEvent(categories, name, ['disabled-by-default-devtools.timeline'], 'Paint')) {
            return normalizeEvent(event, { 'name': 'render' });
        }
        else if (this._isEvent(categories, name, ['disabled-by-default-devtools.timeline'], 'GCEvent')) {
            var normArgs = {
                'usedHeapSize': isPresent(args['usedHeapSizeAfter']) ? args['usedHeapSizeAfter'] :
                    args['usedHeapSizeBefore']
            };
            if (StringWrapper.equals(ph, 'E')) {
                normArgs['majorGc'] = isPresent(majorGCPids[pid]) && majorGCPids[pid];
            }
            majorGCPids[pid] = false;
            return normalizeEvent(event, { 'name': 'gc', 'args': normArgs });
        }
        else if (this._isEvent(categories, name, ['v8'], 'majorGC') &&
            StringWrapper.equals(ph, 'B')) {
            majorGCPids[pid] = true;
        }
        return null; // nothing useful in this event
    }
    _processAsPostChrome44Event(event, categories) {
        var name = event['name'];
        var args = event['args'];
        if (this._isEvent(categories, name, ['devtools.timeline', 'v8'], 'MajorGC')) {
            var normArgs = {
                'majorGc': true,
                'usedHeapSize': isPresent(args['usedHeapSizeAfter']) ? args['usedHeapSizeAfter'] :
                    args['usedHeapSizeBefore']
            };
            return normalizeEvent(event, { 'name': 'gc', 'args': normArgs });
        }
        else if (this._isEvent(categories, name, ['devtools.timeline', 'v8'], 'MinorGC')) {
            var normArgs = {
                'majorGc': false,
                'usedHeapSize': isPresent(args['usedHeapSizeAfter']) ? args['usedHeapSizeAfter'] :
                    args['usedHeapSizeBefore']
            };
            return normalizeEvent(event, { 'name': 'gc', 'args': normArgs });
        }
        else if (this._isEvent(categories, name, ['devtools.timeline', 'v8'], 'FunctionCall') &&
            (isBlank(args) || isBlank(args['data']) ||
                (!StringWrapper.equals(args['data']['scriptName'], 'InjectedScript') &&
                    !StringWrapper.equals(args['data']['scriptName'], '')))) {
            return normalizeEvent(event, { 'name': 'script' });
        }
        else if (this._isEvent(categories, name, ['devtools.timeline', 'blink'], 'UpdateLayoutTree')) {
            return normalizeEvent(event, { 'name': 'render' });
        }
        else if (this._isEvent(categories, name, ['devtools.timeline'], 'UpdateLayerTree') ||
            this._isEvent(categories, name, ['devtools.timeline'], 'Layout') ||
            this._isEvent(categories, name, ['devtools.timeline'], 'Paint')) {
            return normalizeEvent(event, { 'name': 'render' });
        }
        else if (this._isEvent(categories, name, ['devtools.timeline'], 'ResourceReceivedData')) {
            let normArgs = { 'encodedDataLength': args['data']['encodedDataLength'] };
            return normalizeEvent(event, { 'name': 'receivedData', 'args': normArgs });
        }
        else if (this._isEvent(categories, name, ['devtools.timeline'], 'ResourceSendRequest')) {
            let data = args['data'];
            let normArgs = { 'url': data['url'], 'method': data['requestMethod'] };
            return normalizeEvent(event, { 'name': 'sendRequest', 'args': normArgs });
        }
        else if (this._isEvent(categories, name, ['blink.user_timing'], 'navigationStart')) {
            return normalizeEvent(event, { 'name': name });
        }
        return null; // nothing useful in this event
    }
    _parseCategories(categories) { return categories.split(','); }
    _isEvent(eventCategories, eventName, expectedCategories, expectedName = null) {
        var hasCategories = expectedCategories.reduce((value, cat) => { return value && ListWrapper.contains(eventCategories, cat); }, true);
        return isBlank(expectedName) ? hasCategories :
            hasCategories && StringWrapper.equals(eventName, expectedName);
    }
    perfLogFeatures() {
        return new PerfLogFeatures({ render: true, gc: true, frameCapture: true, userTiming: true });
    }
    supports(capabilities) {
        return this._majorChromeVersion != -1 &&
            StringWrapper.equals(capabilities['browserName'].toLowerCase(), 'chrome');
    }
}
function normalizeEvent(chromeEvent, data) {
    var ph = chromeEvent['ph'];
    if (StringWrapper.equals(ph, 'S')) {
        ph = 'b';
    }
    else if (StringWrapper.equals(ph, 'F')) {
        ph = 'e';
    }
    var result = { 'pid': chromeEvent['pid'], 'ph': ph, 'cat': 'timeline', 'ts': chromeEvent['ts'] / 1000 };
    if (chromeEvent['ph'] === 'X') {
        var dur = chromeEvent['dur'];
        if (isBlank(dur)) {
            dur = chromeEvent['tdur'];
        }
        result['dur'] = isBlank(dur) ? 0.0 : dur / 1000;
    }
    StringMapWrapper.forEach(data, (value, prop) => { result[prop] = value; });
    return result;
}
var _PROVIDERS = [
    bind(ChromeDriverExtension)
        .toFactory((driver, userAgent) => new ChromeDriverExtension(driver, userAgent), [WebDriverAdapter, Options.USER_AGENT])
];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2hyb21lX2RyaXZlcl9leHRlbnNpb24uanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJiZW5jaHByZXNzL3NyYy93ZWJkcml2ZXIvY2hyb21lX2RyaXZlcl9leHRlbnNpb24udHMiXSwibmFtZXMiOlsiQ2hyb21lRHJpdmVyRXh0ZW5zaW9uIiwiQ2hyb21lRHJpdmVyRXh0ZW5zaW9uLmNvbnN0cnVjdG9yIiwiQ2hyb21lRHJpdmVyRXh0ZW5zaW9uLkJJTkRJTkdTIiwiQ2hyb21lRHJpdmVyRXh0ZW5zaW9uLl9wYXJzZUNocm9tZVZlcnNpb24iLCJDaHJvbWVEcml2ZXJFeHRlbnNpb24uZ2MiLCJDaHJvbWVEcml2ZXJFeHRlbnNpb24udGltZUJlZ2luIiwiQ2hyb21lRHJpdmVyRXh0ZW5zaW9uLnRpbWVFbmQiLCJDaHJvbWVEcml2ZXJFeHRlbnNpb24ucmVhZFBlcmZMb2ciLCJDaHJvbWVEcml2ZXJFeHRlbnNpb24uX2NvbnZlcnRQZXJmUmVjb3Jkc1RvRXZlbnRzIiwiQ2hyb21lRHJpdmVyRXh0ZW5zaW9uLl9wcm9jZXNzQXNQcmVDaHJvbWU0NUV2ZW50IiwiQ2hyb21lRHJpdmVyRXh0ZW5zaW9uLl9wcm9jZXNzQXNQb3N0Q2hyb21lNDRFdmVudCIsIkNocm9tZURyaXZlckV4dGVuc2lvbi5fcGFyc2VDYXRlZ29yaWVzIiwiQ2hyb21lRHJpdmVyRXh0ZW5zaW9uLl9pc0V2ZW50IiwiQ2hyb21lRHJpdmVyRXh0ZW5zaW9uLnBlcmZMb2dGZWF0dXJlcyIsIkNocm9tZURyaXZlckV4dGVuc2lvbi5zdXBwb3J0cyIsIm5vcm1hbGl6ZUV2ZW50Il0sIm1hcHBpbmdzIjoiT0FBTyxFQUFDLElBQUksRUFBb0IsTUFBTSxzQkFBc0I7T0FDckQsRUFBQyxXQUFXLEVBQUUsZ0JBQWdCLEVBQUMsTUFBTSxnQ0FBZ0M7T0FDckUsRUFDTCxJQUFJLEVBQ0osU0FBUyxFQUNULE9BQU8sRUFFUCxhQUFhLEVBQ2IsYUFBYSxFQUNkLE1BQU0sMEJBQTBCO09BQzFCLEVBQUMs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ZGVyfSBmcm9tICdhbmd1bGFyMi9zcmMvY29yZS9kaSc7XG5pbXBvcnQge0xpc3RXcmFwcGVyLCBTdHJpbmdNYXBXcmFwcGVyfSBmcm9tICdhbmd1bGFyMi9zcmMvZmFjYWRlL2NvbGxlY3Rpb24nO1xuaW1wb3J0IHtcbiAgSnNvbixcbiAgaXNQcmVzZW50LFxuICBpc0JsYW5rLFxuICBSZWdFeHBXcmFwcGVyLFxuICBTdHJpbmdXcmFwcGVyLFxuICBOdW1iZXJXcmFwcGVyXG59IGZyb20gJ2FuZ3VsYXIyL3NyYy9mYWNhZGUvbGFuZyc7XG5pbXBvcnQge0Jhc2VFeGNlcHRpb24sIFdyYXBwZWRFeGNlcHRpb259IGZyb20gJ2FuZ3VsYXIyL3NyYy9mYWNhZGUvZXhjZXB0aW9ucyc7XG5cbmltcG9ydCB7V2ViRHJpdmVyRXh0ZW5zaW9uLCBQZXJmTG9nRmVhdHVyZXN9IGZyb20gJy4uL3dlYl9kcml2ZXJfZXh0ZW5zaW9uJztcbmltcG9ydCB7V2ViRHJpdmVyQWRhcHRlcn0gZnJvbSAnLi4vd2ViX2RyaXZlcl9hZGFwdGVyJztcbmltcG9ydCB7UHJvbWlzZX0gZnJvbSAnYW5ndWxhcjIvc3JjL2ZhY2FkZS9hc3luYyc7XG5pbXBvcnQge09wdGlvbnN9IGZyb20gJy4uL2NvbW1vbl9vcHRpb25zJztcblxuLyoqXG4gKiBTZXQgdGhlIGZvbGxvd2luZyAndHJhY2VDYXRlZ29yaWVzJyB0byBjb2xsZWN0IG1ldHJpY3MgaW4gQ2hyb21lOlxuICogJ3Y4LGJsaW5rLmNvbnNvbGUsZGlzYWJsZWQtYnktZGVmYXVsdC1kZXZ0b29scy50aW1lbGluZSxkZXZ0b29scy50aW1lbGluZSdcbiAqXG4gKiBJbiBvcmRlciB0byBjb2xsZWN0IHRoZSBmcmFtZSByYXRlIHJlbGF0ZWQgbWV0cmljcywgYWRkICdiZW5jaG1hcmsnXG4gKiB0byB0aGUgbGlzdCBhYm92ZS5cbiAqL1xuZXhwb3J0IGNsYXNzIENocm9tZURyaXZlckV4dGVuc2lvbiBleHRlbmRzIFdlYkRyaXZlckV4dGVuc2lvbiB7XG4gIC8vIFRPRE8odGJvc2NoKTogdXNlIHN0YXRpYyB2YWx1ZXMgd2hlbiBvdXIgdHJhbnNwaWxlciBzdXBwb3J0cyB0aGVtXG4gIHN0YXRpYyBnZXQgQklORElOR1MoKTogUHJvdmlkZXJbXSB7IHJldHVybiBfUFJPVklERVJTOyB9XG5cbiAgcHJpdmF0ZSBfbWFqb3JDaHJvbWVWZXJzaW9uOiBudW1iZXI7XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBfZHJpdmVyOiBXZWJEcml2ZXJBZGFwdGVyLCB1c2VyQWdlbnQ6IHN0cmluZykge1xuICAgIHN1cGVyKCk7XG4gICAgdGhpcy5fbWFqb3JDaHJvbWVWZXJzaW9uID0gdGhpcy5fcGFyc2VDaHJvbWVWZXJzaW9uKHVzZXJBZ2VudCk7XG4gIH1cblxuICBwcml2YXRlIF9wYXJzZUNocm9tZVZlcnNpb24odXNlckFnZW50OiBzdHJpbmcpOiBudW1iZXIge1xuICAgIGlmIChpc0JsYW5rKHVzZXJBZ2VudCkpIHtcbiAgICAgIHJldHVybiAtMTtcbiAgICB9XG4gICAgdmFyIHYgPSBTdHJpbmdXcmFwcGVyLnNwbGl0KHVzZXJBZ2VudCwgL0Nocm9tKGV8aXVtKVxcLy9nKVsyXTtcbiAgICBpZiAoaXNCbGFuayh2KSkge1xuICAgICAgcmV0dXJuIC0xO1xuICAgIH1cbiAgICB2ID0gdi5zcGxpdCgnLicpWzBdO1xuICAgIGlmIChpc0JsYW5rKHYpKSB7XG4gICAgICByZXR1cm4gLTE7XG4gICAgfVxuICAgIHJldHVybiBOdW1iZXJXcmFwcGVyLnBhcnNlSW50KHYsIDEwKTtcbiAgfVxuXG4gIGdjKCkgeyByZXR1cm4gdGhpcy5fZHJpdmVyLmV4ZWN1dGVTY3JpcHQoJ3dpbmRvdy5nYygpJyk7IH1cblxuICB0aW1lQmVnaW4obmFtZTogc3RyaW5nKTogUHJvbWlzZTxhbnk+IHtcbiAgICByZXR1cm4gdGhpcy5fZHJpdmVyLmV4ZWN1dGVTY3JpcHQoYGNvbnNvbGUudGltZSgnJHtuYW1lfScpO2ApO1xuICB9XG5cbiAgdGltZUVuZChuYW1lOiBzdHJpbmcsIHJlc3RhcnROYW1lOiBzdHJpbmcgPSBudWxsKTogUHJvbWlzZTxhbnk+IHtcbiAgICB2YXIgc2NyaXB0ID0gYGNvbnNvbGUudGltZUVuZCgnJHtuYW1lfScpO2A7XG4gICAgaWYgKGlzUHJlc2VudChyZXN0YXJ0TmFtZSkpIHtcbiAgICAgIHNjcmlwdCArPSBgY29uc29sZS50aW1lKCcke3Jlc3RhcnROYW1lfScpO2BcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuX2RyaXZlci5leGVjdXRlU2NyaXB0KHNjcmlwdCk7XG4gIH1cblxuICAvLyBTZWUgW0Nocm9tZSBUcmFjZSBFdmVudFxuICAvLyBGb3JtYXRdKGh0dHBzOi8vZG9jcy5nb29nbGUuY29tL2RvY3VtZW50L2QvMUN2QUNsdkZmeUE1Ui1QaFlVbW41T09RdFlNSDRoNkkwblNzS2NoTkF5U1UvZWRpdClcbiAgcmVhZFBlcmZMb2coKTogUHJvbWlzZTxhbnk+IHtcbiAgICAvLyBUT0RPKHRib3NjaCk6IENocm9tZWRyaXZlciBidWcgaHR0cHM6Ly9jb2RlLmdvb2dsZS5jb20vcC9jaHJvbWVkcml2ZXIvaXNzdWVzL2RldGFpbD9pZD0xMDk4XG4gICAgLy8gTmVlZCB0byBleGVjdXRlIGF0IGxlYXN0IG9uZSBjb21tYW5kIHNvIHRoYXQgdGhlIGJyb3dzZXIgbG9ncyBjYW4gYmUgcmVhZCBvdXQhXG4gICAgcmV0dXJuIHRoaXMuX2RyaXZlci5leGVjdXRlU2NyaXB0KCcxKzEnKVxuICAgICAgICAudGhlbigoXykgPT4gdGhpcy5fZHJpdmVyLmxvZ3MoJ3BlcmZvcm1hbmNlJykpXG4gICAgICAgIC50aGVuKChlbnRyaWVzKSA9PiB7XG4gICAgICAgICAgdmFyIGV2ZW50cyA9IFtdO1xuICAgICAgICAgIGVudHJpZXMuZm9yRWFjaChlbnRyeSA9PiB7XG4gICAgICAgICAgICB2YXIgbWVzc2FnZSA9IEpzb24ucGFyc2UoZW50cnlbJ21lc3NhZ2UnXSlbJ21lc3NhZ2UnXTtcbiAgICAgICAgICAgIGlmIChTdHJpbmdXcmFwcGVyLmVxdWFscyhtZXNzYWdlWydtZXRob2QnXSwgJ1RyYWNpbmcuZGF0YUNvbGxlY3RlZCcpKSB7XG4gICAgICAgICAgICAgIGV2ZW50cy5wdXNoKG1lc3NhZ2VbJ3BhcmFtcyddKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChTdHJpbmdXcmFwcGVyLmVxdWFscyhtZXNzYWdlWydtZXRob2QnXSwgJ1RyYWNpbmcuYnVmZmVyVXNhZ2UnKSkge1xuICAgICAgICAgICAgICB0aHJvdyBuZXcgQmFzZUV4Y2VwdGlvbignVGhlIERldlRvb2xzIHRyYWNlIGJ1ZmZlciBmaWxsZWQgZHVyaW5nIHRoZSB0ZXN0IScpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICAgIHJldHVybiB0aGlzLl9jb252ZXJ0UGVyZlJlY29yZHNUb0V2ZW50cyhldmVudHMpO1xuICAgICAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgX2NvbnZlcnRQZXJmUmVjb3Jkc1RvRXZlbnRzKGNocm9tZUV2ZW50czogQXJyYXk8e1trZXk6IHN0cmluZ106IGFueX0+LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBub3JtYWxpemVkRXZlbnRzOiBBcnJheTx7W2tleTogc3RyaW5nXTogYW55fT4gPSBudWxsKSB7XG4gICAgaWYgKGlzQmxhbmsobm9ybWFsaXplZEV2ZW50cykpIHtcbiAgICAgIG5vcm1hbGl6ZWRFdmVudHMgPSBbXTtcbiAgICB9XG4gICAgdmFyIG1ham9yR0NQaWRzID0ge307XG4gICAgY2hyb21lRXZlbnRzLmZvckVhY2goKGV2ZW50KSA9PiB7XG4gICAgICB2YXIgY2F0ZWdvcmllcyA9IHRoaXMuX3BhcnNlQ2F0ZWdvcmllcyhldmVudFsnY2F0J10pO1xuICAgICAgdmFyIG5hbWUgPSBldmVudFsnbmFtZSddO1xuICAgICAgaWYgKHRoaXMuX2lzRXZlbnQoY2F0ZWdvcmllcywgbmFtZSwgWydibGluay5jb25zb2xlJ10pKSB7XG4gICAgICAgIG5vcm1hbGl6ZWRFdmVudHMucHVzaChub3JtYWxpemVFdmVudChldmVudCwgeyduYW1lJzogbmFtZX0pKTtcbiAgICAgIH0gZWxzZSBpZiAodGhpcy5faXNFdmVudChjYXRlZ29yaWVzLCBuYW1lLCBbJ2JlbmNobWFyayddLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdCZW5jaG1hcmtJbnN0cnVtZW50YXRpb246OkltcGxUaHJlYWRSZW5kZXJpbmdTdGF0cycpKSB7XG4gICAgICAgIC8vIFRPRE8oZ29kZXJiYXVlcik6IEluc3RlYWQgb2YgQmVuY2htYXJrSW5zdHJ1bWVudGF0aW9uOjpJbXBsVGhyZWFkUmVuZGVyaW5nU3RhdHMgdGhlXG4gICAgICAgIC8vIGZvbGxvd2luZyBldmVudHMgc2hvdWxkIGJlIHVzZWQgKGlmIGF2YWlsYWJsZSkgZm9yIG1vcmUgYWNjdXJhdGUgbWVhc3VybWVudHM6XG4gICAgICAgIC8vICAgMXN0IGNob2ljZTogdnN5bmNfYmVmb3JlIC0gZ3JvdW5kIHRydXRoIG9uIEFuZHJvaWRcbiAgICAgICAgLy8gICAybmQgY2hvaWNlOiBCZW5jaG1hcmtJbnN0cnVtZW50YXRpb246OkRpc3BsYXlSZW5kZXJpbmdTdGF0cyAtIGF2YWlsYWJsZSBvbiBzeXN0ZW1zIHdpdGhcbiAgICAgICAgLy8gICAgICAgICAgICAgICBuZXcgc3VyZmFjZXMgZnJhbWV3b3JrIChub3QgYnJvYWRseSBlbmFibGVkIHlldClcbiAgICAgICAgLy8gICAzcmQgY2hvaWNlOiBCZW5jaG1hcmtJbnN0cnVtZW50YXRpb246OkltcGxUaHJlYWRSZW5kZXJpbmdTdGF0cyAtIGZhbGxiYWNrIGV2ZW50IHRoYXQgaXNcbiAgICAgICAgLy8gICAgICAgICAgICAgICBhbHdheXMgYXZhaWxhYmxlIGlmIHNvbWV0aGluZyBpcyByZW5kZXJlZFxuICAgICAgICB2YXIgZnJhbWVDb3VudCA9IGV2ZW50WydhcmdzJ11bJ2RhdGEnXVsnZnJhbWVfY291bnQnXTtcbiAgICAgICAgaWYgKGZyYW1lQ291bnQgPiAxKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEJhc2VFeGNlcHRpb24oJ211bHRpLWZyYW1lIHJlbmRlciBzdGF0cyBub3Qgc3VwcG9ydGVkJyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGZyYW1lQ291bnQgPT0gMSkge1xuICAgICAgICAgIG5vcm1hbGl6ZWRFdmVudHMucHVzaChub3JtYWxpemVFdmVudChldmVudCwgeyduYW1lJzogJ2ZyYW1lJ30pKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmICh0aGlzLl9pc0V2ZW50KGNhdGVnb3JpZXMsIG5hbWUsIFsnZGlzYWJsZWQtYnktZGVmYXVsdC1kZXZ0b29scy50aW1lbGluZSddLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdSYXN0ZXJpemUnKSB8fFxuICAgICAgICAgICAgICAgICB0aGlzLl9pc0V2ZW50KGNhdGVnb3JpZXMsIG5hbWUsIFsnZGlzYWJsZWQtYnktZGVmYXVsdC1kZXZ0b29scy50aW1lbGluZSddLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdDb21wb3NpdGVMYXllcnMnKSkge1xuICAgICAgICBub3JtYWxpemVkRXZlbnRzLnB1c2gobm9ybWFsaXplRXZlbnQoZXZlbnQsIHsnbmFtZSc6ICdyZW5kZXInfSkpO1xuICAgICAgfSBlbHNlIGlmICh0aGlzLl9tYWpvckNocm9tZVZlcnNpb24gPCA0NSkge1xuICAgICAgICB2YXIgbm9ybWFsaXplZEV2ZW50ID0gdGhpcy5fcHJvY2Vzc0FzUHJlQ2hyb21lNDVFdmVudChldmVudCwgY2F0ZWdvcmllcywgbWFqb3JHQ1BpZHMpO1xuICAgICAgICBpZiAobm9ybWFsaXplZEV2ZW50ICE9IG51bGwpIG5vcm1hbGl6ZWRFdmVudHMucHVzaChub3JtYWxpemVkRXZlbnQpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdmFyIG5vcm1hbGl6ZWRFdmVudCA9IHRoaXMuX3Byb2Nlc3NBc1Bvc3RDaHJvbWU0NEV2ZW50KGV2ZW50LCBjYXRlZ29yaWVzKTtcbiAgICAgICAgaWYgKG5vcm1hbGl6ZWRFdmVudCAhPSBudWxsKSBub3JtYWxpemVkRXZlbnRzLnB1c2gobm9ybWFsaXplZEV2ZW50KTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICByZXR1cm4gbm9ybWFsaXplZEV2ZW50cztcbiAgfVxuXG4gIHByaXZhdGUgX3Byb2Nlc3NBc1ByZUNocm9tZTQ1RXZlbnQoZXZlbnQsIGNhdGVnb3JpZXMsIG1ham9yR0NQaWRzKSB7XG4gICAgdmFyIG5hbWUgPSBldmVudFsnbmFtZSddO1xuICAgIHZhciBhcmdzID0gZXZlbnRbJ2FyZ3MnXTtcbiAgICB2YXIgcGlkID0gZXZlbnRbJ3BpZCddO1xuICAgIHZhciBwaCA9IGV2ZW50WydwaCddO1xuICAgIGlmICh0aGlzLl9pc0V2ZW50KGNhdGVnb3JpZXMsIG5hbWUsIFsnZGlzYWJsZWQtYnktZGVmYXVsdC1kZXZ0b29scy50aW1lbGluZSddLFxuICAgICAgICAgICAgICAgICAgICAgICdGdW5jdGlvbkNhbGwnKSAmJlxuICAgICAgICAoaXNCbGFuayhhcmdzKSB8fCBpc0JsYW5rKGFyZ3NbJ2RhdGEnXSkgfHxcbiAgICAgICAgICFTdHJpbmdXcmFwcGVyLmVxdWFscyhhcmdzWydkYXRhJ11bJ3NjcmlwdE5hbWUnXSwgJ0luamVjdGVkU2NyaXB0JykpKSB7XG4gICAgICByZXR1cm4gbm9ybWFsaXplRXZlbnQoZXZlbnQsIHsnbmFtZSc6ICdzY3JpcHQnfSk7XG4gICAgfSBlbHNlIGlmICh0aGlzLl9pc0V2ZW50KGNhdGVnb3JpZXMsIG5hbWUsIFsnZGlzYWJsZWQtYnktZGVmYXVsdC1kZXZ0b29scy50aW1lbGluZSddLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnUmVjYWxjdWxhdGVTdHlsZXMnKSB8fFxuICAgICAgICAgICAgICAgdGhpcy5faXNFdmVudChjYXRlZ29yaWVzLCBuYW1lLCBbJ2Rpc2FibGVkLWJ5LWRlZmF1bHQtZGV2dG9vbHMudGltZWxpbmUnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ0xheW91dCcpIHx8XG4gICAgICAgICAgICAgICB0aGlzLl9pc0V2ZW50KGNhdGVnb3JpZXMsIG5hbWUsIFsnZGlzYWJsZWQtYnktZGVmYXVsdC1kZXZ0b29scy50aW1lbGluZSddLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnVXBkYXRlTGF5ZXJUcmVlJykgfHxcbiAgICAgICAgICAgICAgIHRoaXMuX2lzRXZlbnQoY2F0ZWdvcmllcywgbmFtZSwgWydkaXNhYmxlZC1ieS1kZWZhdWx0LWRldnRvb2xzLnRpbWVsaW5lJ10sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICdQYWludCcpKSB7XG4gICAgICByZXR1cm4gbm9ybWFsaXplRXZlbnQoZXZlbnQsIHsnbmFtZSc6ICdyZW5kZXInfSk7XG4gICAgfSBlbHNlIGlmICh0aGlzLl9pc0V2ZW50KGNhdGVnb3JpZXMsIG5hbWUsIFsnZGlzYWJsZWQtYnktZGVmYXVsdC1kZXZ0b29scy50aW1lbGluZSddLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnR0NFdmVudCcpKSB7XG4gICAgICB2YXIgbm9ybUFyZ3MgPSB7XG4gICAgICAgICd1c2VkSGVhcFNpemUnOiBpc1ByZXNlbnQoYXJnc1sndXNlZEhlYXBTaXplQWZ0ZXInXSkgPyBhcmdzWyd1c2VkSGVhcFNpemVBZnRlciddIDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3NbJ3VzZWRIZWFwU2l6ZUJlZm9yZSddXG4gICAgICB9O1xuICAgICAgaWYgKFN0cmluZ1dyYXBwZXIuZXF1YWxzKHBoLCAnRScpKSB7XG4gICAgICAgIG5vcm1BcmdzWydtYWpvckdjJ10gPSBpc1ByZXNlbnQobWFqb3JHQ1BpZHNbcGlkXSkgJiYgbWFqb3JHQ1BpZHNbcGlkXTtcbiAgICAgIH1cbiAgICAgIG1ham9yR0NQaWRzW3BpZF0gPSBmYWxzZTtcbiAgICAgIHJldHVybiBub3JtYWxpemVFdmVudChldmVudCwgeyduYW1lJzogJ2djJywgJ2FyZ3MnOiBub3JtQXJnc30pO1xuICAgIH0gZWxzZSBpZiAodGhpcy5faXNFdmVudChjYXRlZ29yaWVzLCBuYW1lLCBbJ3Y4J10sICdtYWpvckdDJykgJiZcbiAgICAgICAgICAgICAgIFN0cmluZ1dyYXBwZXIuZXF1YWxzKHBoLCAnQicpKSB7XG4gICAgICBtYWpvckdDUGlkc1twaWRdID0gdHJ1ZTtcbiAgICB9XG4gICAgcmV0dXJuIG51bGw7ICAvLyBub3RoaW5nIHVzZWZ1bCBpbiB0aGlzIGV2ZW50XG4gIH1cblxuICBwcml2YXRlIF9wcm9jZXNzQXNQb3N0Q2hyb21lNDRFdmVudChldmVudCwgY2F0ZWdvcmllcykge1xuICAgIHZhciBuYW1lID0gZXZlbnRbJ25hbWUnXTtcbiAgICB2YXIgYXJncyA9IGV2ZW50WydhcmdzJ107XG4gICAgaWYgKHRoaXMuX2lzRXZlbnQoY2F0ZWdvcmllcywgbmFtZSwgWydkZXZ0b29scy50aW1lbGluZScsICd2OCddLCAnTWFqb3JHQycpKSB7XG4gICAgICB2YXIgbm9ybUFyZ3MgPSB7XG4gICAgICAgICdtYWpvckdjJzogdHJ1ZSxcbiAgICAgICAgJ3VzZWRIZWFwU2l6ZSc6IGlzUHJlc2VudChhcmdzWyd1c2VkSGVhcFNpemVBZnRlciddKSA/IGFyZ3NbJ3VzZWRIZWFwU2l6ZUFmdGVyJ10gOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJnc1sndXNlZEhlYXBTaXplQmVmb3JlJ11cbiAgICAgIH07XG4gICAgICByZXR1cm4gbm9ybWFsaXplRXZlbnQoZXZlbnQsIHsnbmFtZSc6ICdnYycsICdhcmdzJzogbm9ybUFyZ3N9KTtcbiAgICB9IGVsc2UgaWYgKHRoaXMuX2lzRXZlbnQoY2F0ZWdvcmllcywgbmFtZSwgWydkZXZ0b29scy50aW1lbGluZScsICd2OCddLCAnTWlub3JHQycpKSB7XG4gICAgICB2YXIgbm9ybUFyZ3MgPSB7XG4gICAgICAgICdtYWpvckdjJzogZmFsc2UsXG4gICAgICAgICd1c2VkSGVhcFNpemUnOiBpc1ByZXNlbnQoYXJnc1sndXNlZEhlYXBTaXplQWZ0ZXInXSkgPyBhcmdzWyd1c2VkSGVhcFNpemVBZnRlciddIDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3NbJ3VzZWRIZWFwU2l6ZUJlZm9yZSddXG4gICAgICB9O1xuICAgICAgcmV0dXJuIG5vcm1hbGl6ZUV2ZW50KGV2ZW50LCB7J25hbWUnOiAnZ2MnLCAnYXJncyc6IG5vcm1BcmdzfSk7XG4gICAgfSBlbHNlIGlmICh0aGlzLl9pc0V2ZW50KGNhdGVnb3JpZXMsIG5hbWUsIFsnZGV2dG9vbHMudGltZWxpbmUnLCAndjgnXSwgJ0Z1bmN0aW9uQ2FsbCcpICYmXG4gICAgICAgICAgICAgICAoaXNCbGFuayhhcmdzKSB8fCBpc0JsYW5rKGFyZ3NbJ2RhdGEnXSkgfHxcbiAgICAgICAgICAgICAgICAoIVN0cmluZ1dyYXBwZXIuZXF1YWxzKGFyZ3NbJ2RhdGEnXVsnc2NyaXB0TmFtZSddLCAnSW5qZWN0ZWRTY3JpcHQnKSAmJlxuICAgICAgICAgICAgICAgICAhU3RyaW5nV3JhcHBlci5lcXVhbHMoYXJnc1snZGF0YSddWydzY3JpcHROYW1lJ10sICcnKSkpKSB7XG4gICAgICByZXR1cm4gbm9ybWFsaXplRXZlbnQoZXZlbnQsIHsnbmFtZSc6ICdzY3JpcHQnfSk7XG4gICAgfSBlbHNlIGlmICh0aGlzLl9pc0V2ZW50KGNhdGVnb3JpZXMsIG5hbWUsIFsnZGV2dG9vbHMudGltZWxpbmUnLCAnYmxpbmsnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1VwZGF0ZUxheW91dFRyZWUnKSkge1xuICAgICAgcmV0dXJuIG5vcm1hbGl6ZUV2ZW50KGV2ZW50LCB7J25hbWUnOiAncmVuZGVyJ30pO1xuICAgIH0gZWxzZSBpZiAodGhpcy5faXNFdmVudChjYXRlZ29yaWVzLCBuYW1lLCBbJ2RldnRvb2xzLnRpbWVsaW5lJ10sICdVcGRhdGVMYXllclRyZWUnKSB8fFxuICAgICAgICAgICAgICAgdGhpcy5faXNFdmVudChjYXRlZ29yaWVzLCBuYW1lLCBbJ2RldnRvb2xzLnRpbWVsaW5lJ10sICdMYXlvdXQnKSB8fFxuICAgICAgICAgICAgICAgdGhpcy5faXNFdmVudChjYXRlZ29yaWVzLCBuYW1lLCBbJ2RldnRvb2xzLnRpbWVsaW5lJ10sICdQYWludCcpKSB7XG4gICAgICByZXR1cm4gbm9ybWFsaXplRXZlbnQoZXZlbnQsIHsnbmFtZSc6ICdyZW5kZXInfSk7XG4gICAgfSBlbHNlIGlmICh0aGlzLl9pc0V2ZW50KGNhdGVnb3JpZXMsIG5hbWUsIFsnZGV2dG9vbHMudGltZWxpbmUnXSwgJ1Jlc291cmNlUmVjZWl2ZWREYXRhJykpIHtcbiAgICAgIGxldCBub3JtQXJncyA9IHsnZW5jb2RlZERhdGFMZW5ndGgnOiBhcmdzWydkYXRhJ11bJ2VuY29kZWREYXRhTGVuZ3RoJ119O1xuICAgICAgcmV0dXJuIG5vcm1hbGl6ZUV2ZW50KGV2ZW50LCB7J25hbWUnOiAncmVjZWl2ZWREYXRhJywgJ2FyZ3MnOiBub3JtQXJnc30pO1xuICAgIH0gZWxzZSBpZiAodGhpcy5faXNFdmVudChjYXRlZ29yaWVzLCBuYW1lLCBbJ2RldnRvb2xzLnRpbWVsaW5lJ10sICdSZXNvdXJjZVNlbmRSZXF1ZXN0JykpIHtcbiAgICAgIGxldCBkYXRhID0gYXJnc1snZGF0YSddO1xuICAgICAgbGV0IG5vcm1BcmdzID0geyd1cmwnOiBkYXRhWyd1cmwnXSwgJ21ldGhvZCc6IGRhdGFbJ3JlcXVlc3RNZXRob2QnXX07XG4gICAgICByZXR1cm4gbm9ybWFsaXplRXZlbnQoZXZlbnQsIHsnbmFtZSc6ICdzZW5kUmVxdWVzdCcsICdhcmdzJzogbm9ybUFyZ3N9KTtcbiAgICB9IGVsc2UgaWYgKHRoaXMuX2lzRXZlbnQoY2F0ZWdvcmllcywgbmFtZSwgWydibGluay51c2VyX3RpbWluZyddLCAnbmF2aWdhdGlvblN0YXJ0JykpIHtcbiAgICAgIHJldHVybiBub3JtYWxpemVFdmVudChldmVudCwgeyduYW1lJzogbmFtZX0pO1xuICAgIH1cbiAgICByZXR1cm4gbnVsbDsgIC8vIG5vdGhpbmcgdXNlZnVsIGluIHRoaXMgZXZlbnRcbiAgfVxuXG4gIHByaXZhdGUgX3BhcnNlQ2F0ZWdvcmllcyhjYXRlZ29yaWVzOiBzdHJpbmcpOiBzdHJpbmdbXSB7IHJldHVybiBjYXRlZ29yaWVzLnNwbGl0KCcsJyk7IH1cblxuICBwcml2YXRlIF9pc0V2ZW50KGV2ZW50Q2F0ZWdvcmllczogc3RyaW5nW10sIGV2ZW50TmFtZTogc3RyaW5nLCBleHBlY3RlZENhdGVnb3JpZXM6IHN0cmluZ1tdLFxuICAgICAgICAgICAgICAgICAgIGV4cGVjdGVkTmFtZTogc3RyaW5nID0gbnVsbCk6IGJvb2xlYW4ge1xuICAgIHZhciBoYXNDYXRlZ29yaWVzID0gZXhwZWN0ZWRDYXRlZ29yaWVzLnJlZHVjZShcbiAgICAgICAgKHZhbHVlLCBjYXQpID0+IHsgcmV0dXJuIHZhbHVlICYmIExpc3RXcmFwcGVyLmNvbnRhaW5zKGV2ZW50Q2F0ZWdvcmllcywgY2F0KTsgfSwgdHJ1ZSk7XG4gICAgcmV0dXJuIGlzQmxhbmsoZXhwZWN0ZWROYW1lKSA/IGhhc0NhdGVnb3JpZXMgOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoYXNDYXRlZ29yaWVzICYmIFN0cmluZ1dyYXBwZXIuZXF1YWxzKGV2ZW50TmFtZSwgZXhwZWN0ZWROYW1lKTtcbiAgfVxuXG4gIHBlcmZMb2dGZWF0dXJlcygpOiBQZXJmTG9nRmVhdHVyZXMge1xuICAgIHJldHVybiBuZXcgUGVyZkxvZ0ZlYXR1cmVzKHtyZW5kZXI6IHRydWUsIGdjOiB0cnVlLCBmcmFtZUNhcHR1cmU6IHRydWUsIHVzZXJUaW1pbmc6IHRydWV9KTtcbiAgfVxuXG4gIHN1cHBvcnRzKGNhcGFiaWxpdGllczoge1trZXk6IHN0cmluZ106IGFueX0pOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5fbWFqb3JDaHJvbWVWZXJzaW9uICE9IC0xICYmXG4gICAgICAgICAgIFN0cmluZ1dyYXBwZXIuZXF1YWxzKGNhcGFiaWxpdGllc1snYnJvd3Nlck5hbWUnXS50b0xvd2VyQ2FzZSgpLCAnY2hyb21lJyk7XG4gIH1cbn1cblxuZnVuY3Rpb24gbm9ybWFsaXplRXZlbnQoY2hyb21lRXZlbnQ6IHtba2V5OiBzdHJpbmddOiBhbnl9LFxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YToge1trZXk6IHN0cmluZ106IGFueX0pOiB7W2tleTogc3RyaW5nXTogYW55fSB7XG4gIHZhciBwaCA9IGNocm9tZUV2ZW50WydwaCddO1xuICBpZiAoU3RyaW5nV3JhcHBlci5lcXVhbHMocGgsICdTJykpIHtcbiAgICBwaCA9ICdiJztcbiAgfSBlbHNlIGlmIChTdHJpbmdXcmFwcGVyLmVxdWFscyhwaCwgJ0YnKSkge1xuICAgIHBoID0gJ2UnO1xuICB9XG4gIHZhciByZXN1bHQgPVxuICAgICAgeydwaWQnOiBjaHJvbWVFdmVudFsncGlkJ10sICdwaCc6IHBoLCAnY2F0JzogJ3RpbWVsaW5lJywgJ3RzJzogY2hyb21lRXZlbnRbJ3RzJ10gLyAxMDAwfTtcbiAgaWYgKGNocm9tZUV2ZW50WydwaCddID09PSAnWCcpIHtcbiAgICB2YXIgZHVyID0gY2hyb21lRXZlbnRbJ2R1ciddO1xuICAgIGlmIChpc0JsYW5rKGR1cikpIHtcbiAgICAgIGR1ciA9IGNocm9tZUV2ZW50Wyd0ZHVyJ107XG4gICAgfVxuICAgIHJlc3VsdFsnZHVyJ10gPSBpc0JsYW5rKGR1cikgPyAwLjAgOiBkdXIgLyAxMDAwO1xuICB9XG4gIFN0cmluZ01hcFdyYXBwZXIuZm9yRWFjaChkYXRhLCAodmFsdWUsIHByb3ApID0+IHsgcmVzdWx0W3Byb3BdID0gdmFsdWU7IH0pO1xuICByZXR1cm4gcmVzdWx0O1xufVxuXG52YXIgX1BST1ZJREVSUyA9IFtcbiAgYmluZChDaHJvbWVEcml2ZXJFeHRlbnNpb24pXG4gICAgICAudG9GYWN0b3J5KChkcml2ZXIsIHVzZXJBZ2VudCkgPT4gbmV3IENocm9tZURyaXZlckV4dGVuc2lvbihkcml2ZXIsIHVzZXJBZ2VudCksXG4gICAgICAgICAgICAgICAgIFtXZWJEcml2ZXJBZGFwdGVyLCBPcHRpb25zLlVTRVJfQUdFTlRdKVxuXTtcbiJdfQ==