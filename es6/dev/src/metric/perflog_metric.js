import { PromiseWrapper, TimerWrapper } from 'angular2/src/facade/async';
import { isPresent, isBlank, StringWrapper, RegExpWrapper, NumberWrapper } from 'angular2/src/facade/lang';
import { BaseException } from 'angular2/src/facade/exceptions';
import { ListWrapper, StringMapWrapper } from 'angular2/src/facade/collection';
import { bind, provide, OpaqueToken } from 'angular2/src/core/di';
import { WebDriverExtension } from '../web_driver_extension';
import { Metric } from '../metric';
import { Options } from '../common_options';
/**
 * A metric that reads out the performance log
 */
export class PerflogMetric extends Metric {
    /**
     * @param driverExtension
     * @param setTimeout
     * @param microMetrics Name and description of metrics provided via console.time / console.timeEnd
     **/
    constructor(_driverExtension, _setTimeout, _microMetrics, _forceGc, _captureFrames, _receivedData, _requestCount) {
        super();
        this._driverExtension = _driverExtension;
        this._setTimeout = _setTimeout;
        this._microMetrics = _microMetrics;
        this._forceGc = _forceGc;
        this._captureFrames = _captureFrames;
        this._receivedData = _receivedData;
        this._requestCount = _requestCount;
        this._remainingEvents = [];
        this._measureCount = 0;
        this._perfLogFeatures = _driverExtension.perfLogFeatures();
        if (!this._perfLogFeatures.userTiming) {
            // User timing is needed for navigationStart.
            this._receivedData = false;
            this._requestCount = false;
        }
    }
    // TODO(tbosch): use static values when our transpiler supports them
    static get BINDINGS() { return _PROVIDERS; }
    // TODO(tbosch): use static values when our transpiler supports them
    static get SET_TIMEOUT() { return _SET_TIMEOUT; }
    describe() {
        var res = {
            'scriptTime': 'script execution time in ms, including gc and render',
            'pureScriptTime': 'script execution time in ms, without gc nor render'
        };
        if (this._perfLogFeatures.render) {
            res['renderTime'] = 'render time in ms';
        }
        if (this._perfLogFeatures.gc) {
            res['gcTime'] = 'gc time in ms';
            res['gcAmount'] = 'gc amount in kbytes';
            res['majorGcTime'] = 'time of major gcs in ms';
            if (this._forceGc) {
                res['forcedGcTime'] = 'forced gc time in ms';
                res['forcedGcAmount'] = 'forced gc amount in kbytes';
            }
        }
        if (this._receivedData) {
            res['receivedData'] = 'encoded bytes received since navigationStart';
        }
        if (this._requestCount) {
            res['requestCount'] = 'count of requests sent since navigationStart';
        }
        if (this._captureFrames) {
            if (!this._perfLogFeatures.frameCapture) {
                var warningMsg = 'WARNING: Metric requested, but not supported by driver';
                // using dot syntax for metric name to keep them grouped together in console reporter
                res['frameTime.mean'] = warningMsg;
                res['frameTime.worst'] = warningMsg;
                res['frameTime.best'] = warningMsg;
                res['frameTime.smooth'] = warningMsg;
            }
            else {
                res['frameTime.mean'] = 'mean frame time in ms (target: 16.6ms for 60fps)';
                res['frameTime.worst'] = 'worst frame time in ms';
                res['frameTime.best'] = 'best frame time in ms';
                res['frameTime.smooth'] = 'percentage of frames that hit 60fps';
            }
        }
        StringMapWrapper.forEach(this._microMetrics, (desc, name) => { StringMapWrapper.set(res, name, desc); });
        return res;
    }
    beginMeasure() {
        var resultPromise = PromiseWrapper.resolve(null);
        if (this._forceGc) {
            resultPromise = resultPromise.then((_) => this._driverExtension.gc());
        }
        return resultPromise.then((_) => this._beginMeasure());
    }
    endMeasure(restart) {
        if (this._forceGc) {
            return this._endPlainMeasureAndMeasureForceGc(restart);
        }
        else {
            return this._endMeasure(restart);
        }
    }
    _endPlainMeasureAndMeasureForceGc(restartMeasure) {
        return this._endMeasure(true).then((measureValues) => {
            // disable frame capture for measurements during forced gc
            var originalFrameCaptureValue = this._captureFrames;
            this._captureFrames = false;
            return this._driverExtension.gc()
                .then((_) => this._endMeasure(restartMeasure))
                .then((forceGcMeasureValues) => {
                this._captureFrames = originalFrameCaptureValue;
                StringMapWrapper.set(measureValues, 'forcedGcTime', forceGcMeasureValues['gcTime']);
                StringMapWrapper.set(measureValues, 'forcedGcAmount', forceGcMeasureValues['gcAmount']);
                return measureValues;
            });
        });
    }
    _beginMeasure() {
        return this._driverExtension.timeBegin(this._markName(this._measureCount++));
    }
    _endMeasure(restart) {
        var markName = this._markName(this._measureCount - 1);
        var nextMarkName = restart ? this._markName(this._measureCount++) : null;
        return this._driverExtension.timeEnd(markName, nextMarkName)
            .then((_) => this._readUntilEndMark(markName));
    }
    _readUntilEndMark(markName, loopCount = 0, startEvent = null) {
        if (loopCount > _MAX_RETRY_COUNT) {
            throw new BaseException(`Tried too often to get the ending mark: ${loopCount}`);
        }
        return this._driverExtension.readPerfLog().then((events) => {
            this._addEvents(events);
            var result = this._aggregateEvents(this._remainingEvents, markName);
            if (isPresent(result)) {
                this._remainingEvents = events;
                return result;
            }
            var completer = PromiseWrapper.completer();
            this._setTimeout(() => completer.resolve(this._readUntilEndMark(markName, loopCount + 1)), 100);
            return completer.promise;
        });
    }
    _addEvents(events) {
        var needSort = false;
        events.forEach(event => {
            if (StringWrapper.equals(event['ph'], 'X')) {
                needSort = true;
                var startEvent = {};
                var endEvent = {};
                StringMapWrapper.forEach(event, (value, prop) => {
                    startEvent[prop] = value;
                    endEvent[prop] = value;
                });
                startEvent['ph'] = 'B';
                endEvent['ph'] = 'E';
                endEvent['ts'] = startEvent['ts'] + startEvent['dur'];
                this._remainingEvents.push(startEvent);
                this._remainingEvents.push(endEvent);
            }
            else {
                this._remainingEvents.push(event);
            }
        });
        if (needSort) {
            // Need to sort because of the ph==='X' events
            ListWrapper.sort(this._remainingEvents, (a, b) => {
                var diff = a['ts'] - b['ts'];
                return diff > 0 ? 1 : diff < 0 ? -1 : 0;
            });
        }
    }
    _aggregateEvents(events, markName) {
        var result = { 'scriptTime': 0, 'pureScriptTime': 0 };
        if (this._perfLogFeatures.gc) {
            result['gcTime'] = 0;
            result['majorGcTime'] = 0;
            result['gcAmount'] = 0;
        }
        if (this._perfLogFeatures.render) {
            result['renderTime'] = 0;
        }
        if (this._captureFrames) {
            result['frameTime.mean'] = 0;
            result['frameTime.best'] = 0;
            result['frameTime.worst'] = 0;
            result['frameTime.smooth'] = 0;
        }
        StringMapWrapper.forEach(this._microMetrics, (desc, name) => { result[name] = 0; });
        if (this._receivedData) {
            result['receivedData'] = 0;
        }
        if (this._requestCount) {
            result['requestCount'] = 0;
        }
        var markStartEvent = null;
        var markEndEvent = null;
        var gcTimeInScript = 0;
        var renderTimeInScript = 0;
        var frameTimestamps = [];
        var frameTimes = [];
        var frameCaptureStartEvent = null;
        var frameCaptureEndEvent = null;
        var intervalStarts = {};
        var intervalStartCount = {};
        events.forEach((event) => {
            var ph = event['ph'];
            var name = event['name'];
            var microIterations = 1;
            var microIterationsMatch = RegExpWrapper.firstMatch(_MICRO_ITERATIONS_REGEX, name);
            if (isPresent(microIterationsMatch)) {
                name = microIterationsMatch[1];
                microIterations = NumberWrapper.parseInt(microIterationsMatch[2], 10);
            }
            if (StringWrapper.equals(ph, 'b') && StringWrapper.equals(name, markName)) {
                markStartEvent = event;
            }
            else if (StringWrapper.equals(ph, 'e') && StringWrapper.equals(name, markName)) {
                markEndEvent = event;
            }
            let isInstant = StringWrapper.equals(ph, 'I') || StringWrapper.equals(ph, 'i');
            if (this._requestCount && StringWrapper.equals(name, 'sendRequest')) {
                result['requestCount'] += 1;
            }
            else if (this._receivedData && StringWrapper.equals(name, 'receivedData') && isInstant) {
                result['receivedData'] += event['args']['encodedDataLength'];
            }
            else if (StringWrapper.equals(name, 'navigationStart')) {
                // We count data + requests since the last navigationStart
                // (there might be chrome extensions loaded by selenium before our page, so there
                // will likely be more than one navigationStart).
                if (this._receivedData) {
                    result['receivedData'] = 0;
                }
                if (this._requestCount) {
                    result['requestCount'] = 0;
                }
            }
            if (isPresent(markStartEvent) && isBlank(markEndEvent) &&
                event['pid'] === markStartEvent['pid']) {
                if (StringWrapper.equals(ph, 'b') && StringWrapper.equals(name, _MARK_NAME_FRAME_CAPUTRE)) {
                    if (isPresent(frameCaptureStartEvent)) {
                        throw new BaseException('can capture frames only once per benchmark run');
                    }
                    if (!this._captureFrames) {
                        throw new BaseException('found start event for frame capture, but frame capture was not requested in benchpress');
                    }
                    frameCaptureStartEvent = event;
                }
                else if (StringWrapper.equals(ph, 'e') &&
                    StringWrapper.equals(name, _MARK_NAME_FRAME_CAPUTRE)) {
                    if (isBlank(frameCaptureStartEvent)) {
                        throw new BaseException('missing start event for frame capture');
                    }
                    frameCaptureEndEvent = event;
                }
                if (isInstant) {
                    if (isPresent(frameCaptureStartEvent) && isBlank(frameCaptureEndEvent) &&
                        StringWrapper.equals(name, 'frame')) {
                        frameTimestamps.push(event['ts']);
                        if (frameTimestamps.length >= 2) {
                            frameTimes.push(frameTimestamps[frameTimestamps.length - 1] -
                                frameTimestamps[frameTimestamps.length - 2]);
                        }
                    }
                }
                if (StringWrapper.equals(ph, 'B') || StringWrapper.equals(ph, 'b')) {
                    if (isBlank(intervalStarts[name])) {
                        intervalStartCount[name] = 1;
                        intervalStarts[name] = event;
                    }
                    else {
                        intervalStartCount[name]++;
                    }
                }
                else if ((StringWrapper.equals(ph, 'E') || StringWrapper.equals(ph, 'e')) &&
                    isPresent(intervalStarts[name])) {
                    intervalStartCount[name]--;
                    if (intervalStartCount[name] === 0) {
                        var startEvent = intervalStarts[name];
                        var duration = (event['ts'] - startEvent['ts']);
                        intervalStarts[name] = null;
                        if (StringWrapper.equals(name, 'gc')) {
                            result['gcTime'] += duration;
                            var amount = (startEvent['args']['usedHeapSize'] - event['args']['usedHeapSize']) / 1000;
                            result['gcAmount'] += amount;
                            var majorGc = event['args']['majorGc'];
                            if (isPresent(majorGc) && majorGc) {
                                result['majorGcTime'] += duration;
                            }
                            if (isPresent(intervalStarts['script'])) {
                                gcTimeInScript += duration;
                            }
                        }
                        else if (StringWrapper.equals(name, 'render')) {
                            result['renderTime'] += duration;
                            if (isPresent(intervalStarts['script'])) {
                                renderTimeInScript += duration;
                            }
                        }
                        else if (StringWrapper.equals(name, 'script')) {
                            result['scriptTime'] += duration;
                        }
                        else if (isPresent(this._microMetrics[name])) {
                            result[name] += duration / microIterations;
                        }
                    }
                }
            }
        });
        if (!isPresent(markStartEvent) || !isPresent(markEndEvent)) {
            // not all events have been received, no further processing for now
            return null;
        }
        if (isPresent(markEndEvent) && isPresent(frameCaptureStartEvent) &&
            isBlank(frameCaptureEndEvent)) {
            throw new BaseException('missing end event for frame capture');
        }
        if (this._captureFrames && isBlank(frameCaptureStartEvent)) {
            throw new BaseException('frame capture requested in benchpress, but no start event was found');
        }
        if (frameTimes.length > 0) {
            this._addFrameMetrics(result, frameTimes);
        }
        result['pureScriptTime'] = result['scriptTime'] - gcTimeInScript - renderTimeInScript;
        return result;
    }
    _addFrameMetrics(result, frameTimes) {
        result['frameTime.mean'] = frameTimes.reduce((a, b) => a + b, 0) / frameTimes.length;
        var firstFrame = frameTimes[0];
        result['frameTime.worst'] = frameTimes.reduce((a, b) => a > b ? a : b, firstFrame);
        result['frameTime.best'] = frameTimes.reduce((a, b) => a < b ? a : b, firstFrame);
        result['frameTime.smooth'] =
            frameTimes.filter(t => t < _FRAME_TIME_SMOOTH_THRESHOLD).length / frameTimes.length;
    }
    _markName(index) { return `${_MARK_NAME_PREFIX}${index}`; }
}
var _MICRO_ITERATIONS_REGEX = /(.+)\*(\d+)$/g;
var _MAX_RETRY_COUNT = 20;
var _MARK_NAME_PREFIX = 'benchpress';
var _SET_TIMEOUT = new OpaqueToken('PerflogMetric.setTimeout');
var _MARK_NAME_FRAME_CAPUTRE = 'frameCapture';
// using 17ms as a somewhat looser threshold, instead of 16.6666ms
var _FRAME_TIME_SMOOTH_THRESHOLD = 17;
var _PROVIDERS = [
    bind(PerflogMetric)
        .toFactory((driverExtension, setTimeout, microMetrics, forceGc, captureFrames, receivedData, requestCount) => new PerflogMetric(driverExtension, setTimeout, microMetrics, forceGc, captureFrames, receivedData, requestCount), [
        WebDriverExtension,
        _SET_TIMEOUT,
        Options.MICRO_METRICS,
        Options.FORCE_GC,
        Options.CAPTURE_FRAMES,
        Options.RECEIVED_DATA,
        Options.REQUEST_COUNT
    ]),
    provide(_SET_TIMEOUT, { useValue: (fn, millis) => TimerWrapper.setTimeout(fn, millis) })
];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGVyZmxvZ19tZXRyaWMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJiZW5jaHByZXNzL3NyYy9tZXRyaWMvcGVyZmxvZ19tZXRyaWMudHMiXSwibmFtZXMiOlsiUGVyZmxvZ01ldHJpYyIsIlBlcmZsb2dNZXRyaWMuY29uc3RydWN0b3IiLCJQZXJmbG9nTWV0cmljLkJJTkRJTkdTIiwiUGVyZmxvZ01ldHJpYy5TRVRfVElNRU9VVCIsIlBlcmZsb2dNZXRyaWMuZGVzY3JpYmUiLCJQZXJmbG9nTWV0cmljLmJlZ2luTWVhc3VyZSIsIlBlcmZsb2dNZXRyaWMuZW5kTWVhc3VyZSIsIlBlcmZsb2dNZXRyaWMuX2VuZFBsYWluTWVhc3VyZUFuZE1lYXN1cmVGb3JjZUdjIiwiUGVyZmxvZ01ldHJpYy5fYmVnaW5NZWFzdXJlIiwiUGVyZmxvZ01ldHJpYy5fZW5kTWVhc3VyZSIsIlBlcmZsb2dNZXRyaWMuX3JlYWRVbnRpbEVuZE1hcmsiLCJQZXJmbG9nTWV0cmljLl9hZGRFdmVudHMiLCJQZXJmbG9nTWV0cmljLl9hZ2dyZWdhdGVFdmVudHMiLCJQZXJmbG9nTWV0cmljLl9hZGRGcmFtZU1ldHJpY3MiLCJQZXJmbG9nTWV0cmljLl9tYXJrTmFtZSJdLCJtYXBwaW5ncyI6Ik9BQU8sRUFBQyxjQUFjLEVBQVcsWUFBWSxFQUFDLE1BQU0sMkJBQTJCO09BQ3hFLEVBQ0wsU0FBUyxFQUNULE9BQU8sRUFDUCxhQUFhLEVBRWIsYUFBYSxFQUNiLGFBQWEsRUFDZCxNQUFNLDBCQUEwQjtPQUMxQixFQUFDLGFBQWEsRUFBbUIsTUFBTSxnQ0FBZ0M7T0FDdkUsRUFBQyxXQUFXLEVBQUUsZ0JBQWdCLEVBQUMsTUFBTSxnQ0FBZ0M7T0FDckUsRUFBQyxJQUFJLEVBQUUsT0FBTyxFQUFZLFdBQVcsRUFBQyxNQUFNLHNCQUFzQjtPQUVsRSxFQUFDLGtCQUFrQixFQUFrQixNQUFNLHlCQUF5QjtPQUNwRSxFQUFDLE1BQU0sRUFBQyxNQUFNLFdBQVc7T0FDekIsRUFBQyxPQUFP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YUFBYSxFQUFFLFlBQVksRUFDL0UsWUFBWSxLQUFLLElBQUksYUFBYSxDQUFDLGVBQWUsRUFBRSxVQUFVLEVBQUUsWUFBWSxFQUFFLE9BQU8sRUFDbEQsYUFBYSxFQUFFLFlBQVksRUFBRSxZQUFZLENBQUMsRUFDOUU7UUFDRSxrQkFBa0I7UUFDbEIsWUFBWTtRQUNaLE9BQU8sQ0FBQyxhQUFhO1FBQ3JCLE9BQU8sQ0FBQyxRQUFRO1FBQ2hCLE9BQU8sQ0FBQyxjQUFjO1FBQ3RCLE9BQU8sQ0FBQyxhQUFhO1FBQ3JCLE9BQU8sQ0FBQyxhQUFhO0tBQ3RCLENBQUM7SUFDVixPQUFPLENBQUMsWUFBWSxFQUFFLEVBQUMsUUFBUSxFQUFFLENBQUMsRUFBRSxFQUFFLE1BQU0sS0FBSyxZQUFZLENBQUMsVUFBVSxDQUFDLEVBQUUsRUFBRSxNQUFNLENBQUMsRUFBQyxDQUFDO0NBQ3ZGLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1Byb21pc2VXcmFwcGVyLCBQcm9taXNlLCBUaW1lcldyYXBwZXJ9IGZyb20gJ2FuZ3VsYXIyL3NyYy9mYWNhZGUvYXN5bmMnO1xuaW1wb3J0IHtcbiAgaXNQcmVzZW50LFxuICBpc0JsYW5rLFxuICBTdHJpbmdXcmFwcGVyLFxuICBNYXRoLFxuICBSZWdFeHBXcmFwcGVyLFxuICBOdW1iZXJXcmFwcGVyXG59IGZyb20gJ2FuZ3VsYXIyL3NyYy9mYWNhZGUvbGFuZyc7XG5pbXBvcnQge0Jhc2VFeGNlcHRpb24sIFdyYXBwZWRFeGNlcHRpb259IGZyb20gJ2FuZ3VsYXIyL3NyYy9mYWNhZGUvZXhjZXB0aW9ucyc7XG5pbXBvcnQge0xpc3RXcmFwcGVyLCBTdHJpbmdNYXBXcmFwcGVyfSBmcm9tICdhbmd1bGFyMi9zcmMvZmFjYWRlL2NvbGxlY3Rpb24nO1xuaW1wb3J0IHtiaW5kLCBwcm92aWRlLCBQcm92aWRlciwgT3BhcXVlVG9rZW59IGZyb20gJ2FuZ3VsYXIyL3NyYy9jb3JlL2RpJztcblxuaW1wb3J0IHtXZWJEcml2ZXJFeHRlbnNpb24sIFBlcmZMb2dGZWF0dXJlc30gZnJvbSAnLi4vd2ViX2RyaXZlcl9leHRlbnNpb24nO1xuaW1wb3J0IHtNZXRyaWN9IGZyb20gJy4uL21ldHJpYyc7XG5pbXBvcnQge09wdGlvbnN9IGZyb20gJy4uL2NvbW1vbl9vcHRpb25zJztcblxuLyoqXG4gKiBBIG1ldHJpYyB0aGF0IHJlYWRzIG91dCB0aGUgcGVyZm9ybWFuY2UgbG9nXG4gKi9cbmV4cG9ydCBjbGFzcyBQZXJmbG9nTWV0cmljIGV4dGVuZHMgTWV0cmljIHtcbiAgLy8gVE9ETyh0Ym9zY2gpOiB1c2Ugc3RhdGljIHZhbHVlcyB3aGVuIG91ciB0cmFuc3BpbGVyIHN1cHBvcnRzIHRoZW1cbiAgc3RhdGljIGdldCBCSU5ESU5HUygpOiBQcm92aWRlcltdIHsgcmV0dXJuIF9QUk9WSURFUlM7IH1cbiAgLy8gVE9ETyh0Ym9zY2gpOiB1c2Ugc3RhdGljIHZhbHVlcyB3aGVuIG91ciB0cmFuc3BpbGVyIHN1cHBvcnRzIHRoZW1cbiAgc3RhdGljIGdldCBTRVRfVElNRU9VVCgpOiBPcGFxdWVUb2tlbiB7IHJldHVybiBfU0VUX1RJTUVPVVQ7IH1cblxuICBwcml2YXRlIF9yZW1haW5pbmdFdmVudHM6IEFycmF5PHtba2V5OiBzdHJpbmddOiBhbnl9PjtcbiAgcHJpdmF0ZSBfbWVhc3VyZUNvdW50OiBudW1iZXI7XG4gIF9wZXJmTG9nRmVhdHVyZXM6IFBlcmZMb2dGZWF0dXJlcztcblxuXG4gIC8qKlxuICAgKiBAcGFyYW0gZHJpdmVyRXh0ZW5zaW9uXG4gICAqIEBwYXJhbSBzZXRUaW1lb3V0XG4gICAqIEBwYXJhbSBtaWNyb01ldHJpY3MgTmFtZSBhbmQgZGVzY3JpcHRpb24gb2YgbWV0cmljcyBwcm92aWRlZCB2aWEgY29uc29sZS50aW1lIC8gY29uc29sZS50aW1lRW5kXG4gICAqKi9cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBfZHJpdmVyRXh0ZW5zaW9uOiBXZWJEcml2ZXJFeHRlbnNpb24sIHByaXZhdGUgX3NldFRpbWVvdXQ6IEZ1bmN0aW9uLFxuICAgICAgICAgICAgICBwcml2YXRlIF9taWNyb01ldHJpY3M6IHtba2V5OiBzdHJpbmddOiBhbnl9LCBwcml2YXRlIF9mb3JjZUdjOiBib29sZWFuLFxuICAgICAgICAgICAgICBwcml2YXRlIF9jYXB0dXJlRnJhbWVzOiBib29sZWFuLCBwcml2YXRlIF9yZWNlaXZlZERhdGE6IGJvb2xlYW4sXG4gICAgICAgICAgICAgIHByaXZhdGUgX3JlcXVlc3RDb3VudDogYm9vbGVhbikge1xuICAgIHN1cGVyKCk7XG5cbiAgICB0aGlzLl9yZW1haW5pbmdFdmVudHMgPSBbXTtcbiAgICB0aGlzLl9tZWFzdXJlQ291bnQgPSAwO1xuICAgIHRoaXMuX3BlcmZMb2dGZWF0dXJlcyA9IF9kcml2ZXJFeHRlbnNpb24ucGVyZkxvZ0ZlYXR1cmVzKCk7XG4gICAgaWYgKCF0aGlzLl9wZXJmTG9nRmVhdHVyZXMudXNlclRpbWluZykge1xuICAgICAgLy8gVXNlciB0aW1pbmcgaXMgbmVlZGVkIGZvciBuYXZpZ2F0aW9uU3RhcnQuXG4gICAgICB0aGlzLl9yZWNlaXZlZERhdGEgPSBmYWxzZTtcbiAgICAgIHRoaXMuX3JlcXVlc3RDb3VudCA9IGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIGRlc2NyaWJlKCk6IHtba2V5OiBzdHJpbmddOiBhbnl9IHtcbiAgICB2YXIgcmVzID0ge1xuICAgICAgJ3NjcmlwdFRpbWUnOiAnc2NyaXB0IGV4ZWN1dGlvbiB0aW1lIGluIG1zLCBpbmNsdWRpbmcgZ2MgYW5kIHJlbmRlcicsXG4gICAgICAncHVyZVNjcmlwdFRpbWUnOiAnc2NyaXB0IGV4ZWN1dGlvbiB0aW1lIGluIG1zLCB3aXRob3V0IGdjIG5vciByZW5kZXInXG4gICAgfTtcbiAgICBpZiAodGhpcy5fcGVyZkxvZ0ZlYXR1cmVzLnJlbmRlcikge1xuICAgICAgcmVzWydyZW5kZXJUaW1lJ10gPSAncmVuZGVyIHRpbWUgaW4gbXMnO1xuICAgIH1cbiAgICBpZiAodGhpcy5fcGVyZkxvZ0ZlYXR1cmVzLmdjKSB7XG4gICAgICByZXNbJ2djVGltZSddID0gJ2djIHRpbWUgaW4gbXMnO1xuICAgICAgcmVzWydnY0Ftb3VudCddID0gJ2djIGFtb3VudCBpbiBrYnl0ZXMnO1xuICAgICAgcmVzWydtYWpvckdjVGltZSddID0gJ3RpbWUgb2YgbWFqb3IgZ2NzIGluIG1zJztcbiAgICAgIGlmICh0aGlzLl9mb3JjZUdjKSB7XG4gICAgICAgIHJlc1snZm9yY2VkR2NUaW1lJ10gPSAnZm9yY2VkIGdjIHRpbWUgaW4gbXMnO1xuICAgICAgICByZXNbJ2ZvcmNlZEdjQW1vdW50J10gPSAnZm9yY2VkIGdjIGFtb3VudCBpbiBrYnl0ZXMnO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAodGhpcy5fcmVjZWl2ZWREYXRhKSB7XG4gICAgICByZXNbJ3JlY2VpdmVkRGF0YSddID0gJ2VuY29kZWQgYnl0ZXMgcmVjZWl2ZWQgc2luY2UgbmF2aWdhdGlvblN0YXJ0JztcbiAgICB9XG4gICAgaWYgKHRoaXMuX3JlcXVlc3RDb3VudCkge1xuICAgICAgcmVzWydyZXF1ZXN0Q291bnQnXSA9ICdjb3VudCBvZiByZXF1ZXN0cyBzZW50IHNpbmNlIG5hdmlnYXRpb25TdGFydCc7XG4gICAgfVxuICAgIGlmICh0aGlzLl9jYXB0dXJlRnJhbWVzKSB7XG4gICAgICBpZiAoIXRoaXMuX3BlcmZMb2dGZWF0dXJlcy5mcmFtZUNhcHR1cmUpIHtcbiAgICAgICAgdmFyIHdhcm5pbmdNc2cgPSAnV0FSTklORzogTWV0cmljIHJlcXVlc3RlZCwgYnV0IG5vdCBzdXBwb3J0ZWQgYnkgZHJpdmVyJztcbiAgICAgICAgLy8gdXNpbmcgZG90IHN5bnRheCBmb3IgbWV0cmljIG5hbWUgdG8ga2VlcCB0aGVtIGdyb3VwZWQgdG9nZXRoZXIgaW4gY29uc29sZSByZXBvcnRlclxuICAgICAgICByZXNbJ2ZyYW1lVGltZS5tZWFuJ10gPSB3YXJuaW5nTXNnO1xuICAgICAgICByZXNbJ2ZyYW1lVGltZS53b3JzdCddID0gd2FybmluZ01zZztcbiAgICAgICAgcmVzWydmcmFtZVRpbWUuYmVzdCddID0gd2FybmluZ01zZztcbiAgICAgICAgcmVzWydmcmFtZVRpbWUuc21vb3RoJ10gPSB3YXJuaW5nTXNnO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmVzWydmcmFtZVRpbWUubWVhbiddID0gJ21lYW4gZnJhbWUgdGltZSBpbiBtcyAodGFyZ2V0OiAxNi42bXMgZm9yIDYwZnBzKSc7XG4gICAgICAgIHJlc1snZnJhbWVUaW1lLndvcnN0J10gPSAnd29yc3QgZnJhbWUgdGltZSBpbiBtcyc7XG4gICAgICAgIHJlc1snZnJhbWVUaW1lLmJlc3QnXSA9ICdiZXN0IGZyYW1lIHRpbWUgaW4gbXMnO1xuICAgICAgICByZXNbJ2ZyYW1lVGltZS5zbW9vdGgnXSA9ICdwZXJjZW50YWdlIG9mIGZyYW1lcyB0aGF0IGhpdCA2MGZwcyc7XG4gICAgICB9XG4gICAgfVxuICAgIFN0cmluZ01hcFdyYXBwZXIuZm9yRWFjaCh0aGlzLl9taWNyb01ldHJpY3MsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIChkZXNjLCBuYW1lKSA9PiB7IFN0cmluZ01hcFdyYXBwZXIuc2V0KHJlcywgbmFtZSwgZGVzYyk7IH0pO1xuICAgIHJldHVybiByZXM7XG4gIH1cblxuICBiZWdpbk1lYXN1cmUoKTogUHJvbWlzZTxhbnk+IHtcbiAgICB2YXIgcmVzdWx0UHJvbWlzZSA9IFByb21pc2VXcmFwcGVyLnJlc29sdmUobnVsbCk7XG4gICAgaWYgKHRoaXMuX2ZvcmNlR2MpIHtcbiAgICAgIHJlc3VsdFByb21pc2UgPSByZXN1bHRQcm9taXNlLnRoZW4oKF8pID0+IHRoaXMuX2RyaXZlckV4dGVuc2lvbi5nYygpKTtcbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdFByb21pc2UudGhlbigoXykgPT4gdGhpcy5fYmVnaW5NZWFzdXJlKCkpO1xuICB9XG5cbiAgZW5kTWVhc3VyZShyZXN0YXJ0OiBib29sZWFuKTogUHJvbWlzZTx7W2tleTogc3RyaW5nXTogYW55fT4ge1xuICAgIGlmICh0aGlzLl9mb3JjZUdjKSB7XG4gICAgICByZXR1cm4gdGhpcy5fZW5kUGxhaW5NZWFzdXJlQW5kTWVhc3VyZUZvcmNlR2MocmVzdGFydCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiB0aGlzLl9lbmRNZWFzdXJlKHJlc3RhcnQpO1xuICAgIH1cbiAgfVxuXG4gIF9lbmRQbGFpbk1lYXN1cmVBbmRNZWFzdXJlRm9yY2VHYyhyZXN0YXJ0TWVhc3VyZTogYm9vbGVhbikge1xuICAgIHJldHVybiB0aGlzLl9lbmRNZWFzdXJlKHRydWUpLnRoZW4oKG1lYXN1cmVWYWx1ZXMpID0+IHtcbiAgICAgIC8vIGRpc2FibGUgZnJhbWUgY2FwdHVyZSBmb3IgbWVhc3VyZW1lbnRzIGR1cmluZyBmb3JjZWQgZ2NcbiAgICAgIHZhciBvcmlnaW5hbEZyYW1lQ2FwdHVyZVZhbHVlID0gdGhpcy5fY2FwdHVyZUZyYW1lcztcbiAgICAgIHRoaXMuX2NhcHR1cmVGcmFtZXMgPSBmYWxzZTtcbiAgICAgIHJldHVybiB0aGlzLl9kcml2ZXJFeHRlbnNpb24uZ2MoKVxuICAgICAgICAgIC50aGVuKChfKSA9PiB0aGlzLl9lbmRNZWFzdXJlKHJlc3RhcnRNZWFzdXJlKSlcbiAgICAgICAgICAudGhlbigoZm9yY2VHY01lYXN1cmVWYWx1ZXMpID0+IHtcbiAgICAgICAgICAgIHRoaXMuX2NhcHR1cmVGcmFtZXMgPSBvcmlnaW5hbEZyYW1lQ2FwdHVyZVZhbHVlO1xuICAgICAgICAgICAgU3RyaW5nTWFwV3JhcHBlci5zZXQobWVhc3VyZVZhbHVlcywgJ2ZvcmNlZEdjVGltZScsIGZvcmNlR2NNZWFzdXJlVmFsdWVzWydnY1RpbWUnXSk7XG4gICAgICAgICAgICBTdHJpbmdNYXBXcmFwcGVyLnNldChtZWFzdXJlVmFsdWVzLCAnZm9yY2VkR2NBbW91bnQnLCBmb3JjZUdjTWVhc3VyZVZhbHVlc1snZ2NBbW91bnQnXSk7XG4gICAgICAgICAgICByZXR1cm4gbWVhc3VyZVZhbHVlcztcbiAgICAgICAgICB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIF9iZWdpbk1lYXN1cmUoKTogUHJvbWlzZTxhbnk+IHtcbiAgICByZXR1cm4gdGhpcy5fZHJpdmVyRXh0ZW5zaW9uLnRpbWVCZWdpbih0aGlzLl9tYXJrTmFtZSh0aGlzLl9tZWFzdXJlQ291bnQrKykpO1xuICB9XG5cbiAgX2VuZE1lYXN1cmUocmVzdGFydDogYm9vbGVhbik6IFByb21pc2U8e1trZXk6IHN0cmluZ106IGFueX0+IHtcbiAgICB2YXIgbWFya05hbWUgPSB0aGlzLl9tYXJrTmFtZSh0aGlzLl9tZWFzdXJlQ291bnQgLSAxKTtcbiAgICB2YXIgbmV4dE1hcmtOYW1lID0gcmVzdGFydCA/IHRoaXMuX21hcmtOYW1lKHRoaXMuX21lYXN1cmVDb3VudCsrKSA6IG51bGw7XG4gICAgcmV0dXJuIHRoaXMuX2RyaXZlckV4dGVuc2lvbi50aW1lRW5kKG1hcmtOYW1lLCBuZXh0TWFya05hbWUpXG4gICAgICAgIC50aGVuKChfKSA9PiB0aGlzLl9yZWFkVW50aWxFbmRNYXJrKG1hcmtOYW1lKSk7XG4gIH1cblxuICBfcmVhZFVudGlsRW5kTWFyayhtYXJrTmFtZTogc3RyaW5nLCBsb29wQ291bnQ6IG51bWJlciA9IDAsIHN0YXJ0RXZlbnQgPSBudWxsKSB7XG4gICAgaWYgKGxvb3BDb3VudCA+IF9NQVhfUkVUUllfQ09VTlQpIHtcbiAgICAgIHRocm93IG5ldyBCYXNlRXhjZXB0aW9uKGBUcmllZCB0b28gb2Z0ZW4gdG8gZ2V0IHRoZSBlbmRpbmcgbWFyazogJHtsb29wQ291bnR9YCk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLl9kcml2ZXJFeHRlbnNpb24ucmVhZFBlcmZMb2coKS50aGVuKChldmVudHMpID0+IHtcbiAgICAgIHRoaXMuX2FkZEV2ZW50cyhldmVudHMpO1xuICAgICAgdmFyIHJlc3VsdCA9IHRoaXMuX2FnZ3JlZ2F0ZUV2ZW50cyh0aGlzLl9yZW1haW5pbmdFdmVudHMsIG1hcmtOYW1lKTtcbiAgICAgIGlmIChpc1ByZXNlbnQocmVzdWx0KSkge1xuICAgICAgICB0aGlzLl9yZW1haW5pbmdFdmVudHMgPSBldmVudHM7XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICB9XG4gICAgICB2YXIgY29tcGxldGVyID0gUHJvbWlzZVdyYXBwZXIuY29tcGxldGVyKCk7XG4gICAgICB0aGlzLl9zZXRUaW1lb3V0KCgpID0+IGNvbXBsZXRlci5yZXNvbHZlKHRoaXMuX3JlYWRVbnRpbEVuZE1hcmsobWFya05hbWUsIGxvb3BDb3VudCArIDEpKSxcbiAgICAgICAgICAgICAgICAgICAgICAgMTAwKTtcbiAgICAgIHJldHVybiBjb21wbGV0ZXIucHJvbWlzZTtcbiAgICB9KTtcbiAgfVxuXG4gIF9hZGRFdmVudHMoZXZlbnRzOiB7IFtrZXk6IHN0cmluZ106IHN0cmluZyB9W10pIHtcbiAgICB2YXIgbmVlZFNvcnQgPSBmYWxzZTtcbiAgICBldmVudHMuZm9yRWFjaChldmVudCA9PiB7XG4gICAgICBpZiAoU3RyaW5nV3JhcHBlci5lcXVhbHMoZXZlbnRbJ3BoJ10sICdYJykpIHtcbiAgICAgICAgbmVlZFNvcnQgPSB0cnVlO1xuICAgICAgICB2YXIgc3RhcnRFdmVudCA9IHt9O1xuICAgICAgICB2YXIgZW5kRXZlbnQgPSB7fTtcbiAgICAgICAgU3RyaW5nTWFwV3JhcHBlci5mb3JFYWNoKGV2ZW50LCAodmFsdWUsIHByb3ApID0+IHtcbiAgICAgICAgICBzdGFydEV2ZW50W3Byb3BdID0gdmFsdWU7XG4gICAgICAgICAgZW5kRXZlbnRbcHJvcF0gPSB2YWx1ZTtcbiAgICAgICAgfSk7XG4gICAgICAgIHN0YXJ0RXZlbnRbJ3BoJ10gPSAnQic7XG4gICAgICAgIGVuZEV2ZW50WydwaCddID0gJ0UnO1xuICAgICAgICBlbmRFdmVudFsndHMnXSA9IHN0YXJ0RXZlbnRbJ3RzJ10gKyBzdGFydEV2ZW50WydkdXInXTtcbiAgICAgICAgdGhpcy5fcmVtYWluaW5nRXZlbnRzLnB1c2goc3RhcnRFdmVudCk7XG4gICAgICAgIHRoaXMuX3JlbWFpbmluZ0V2ZW50cy5wdXNoKGVuZEV2ZW50KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuX3JlbWFpbmluZ0V2ZW50cy5wdXNoKGV2ZW50KTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICBpZiAobmVlZFNvcnQpIHtcbiAgICAgIC8vIE5lZWQgdG8gc29ydCBiZWNhdXNlIG9mIHRoZSBwaD09PSdYJyBldmVudHNcbiAgICAgIExpc3RXcmFwcGVyLnNvcnQodGhpcy5fcmVtYWluaW5nRXZlbnRzLCAoYSwgYikgPT4ge1xuICAgICAgICB2YXIgZGlmZiA9IGFbJ3RzJ10gLSBiWyd0cyddO1xuICAgICAgICByZXR1cm4gZGlmZiA+IDAgPyAxIDogZGlmZiA8IDAgPyAtMSA6IDA7XG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICBfYWdncmVnYXRlRXZlbnRzKGV2ZW50czogQXJyYXk8e1trZXk6IHN0cmluZ106IGFueX0+LCBtYXJrTmFtZSk6IHtba2V5OiBzdHJpbmddOiBhbnl9IHtcbiAgICB2YXIgcmVzdWx0ID0geydzY3JpcHRUaW1lJzogMCwgJ3B1cmVTY3JpcHRUaW1lJzogMH07XG4gICAgaWYgKHRoaXMuX3BlcmZMb2dGZWF0dXJlcy5nYykge1xuICAgICAgcmVzdWx0WydnY1RpbWUnXSA9IDA7XG4gICAgICByZXN1bHRbJ21ham9yR2NUaW1lJ10gPSAwO1xuICAgICAgcmVzdWx0WydnY0Ftb3VudCddID0gMDtcbiAgICB9XG4gICAgaWYgKHRoaXMuX3BlcmZMb2dGZWF0dXJlcy5yZW5kZXIpIHtcbiAgICAgIHJlc3VsdFsncmVuZGVyVGltZSddID0gMDtcbiAgICB9XG4gICAgaWYgKHRoaXMuX2NhcHR1cmVGcmFtZXMpIHtcbiAgICAgIHJlc3VsdFsnZnJhbWVUaW1lLm1lYW4nXSA9IDA7XG4gICAgICByZXN1bHRbJ2ZyYW1lVGltZS5iZXN0J10gPSAwO1xuICAgICAgcmVzdWx0WydmcmFtZVRpbWUud29yc3QnXSA9IDA7XG4gICAgICByZXN1bHRbJ2ZyYW1lVGltZS5zbW9vdGgnXSA9IDA7XG4gICAgfVxuICAgIFN0cmluZ01hcFdyYXBwZXIuZm9yRWFjaCh0aGlzLl9taWNyb01ldHJpY3MsIChkZXNjLCBuYW1lKSA9PiB7IHJlc3VsdFtuYW1lXSA9IDA7IH0pO1xuICAgIGlmICh0aGlzLl9yZWNlaXZlZERhdGEpIHtcbiAgICAgIHJlc3VsdFsncmVjZWl2ZWREYXRhJ10gPSAwO1xuICAgIH1cbiAgICBpZiAodGhpcy5fcmVxdWVzdENvdW50KSB7XG4gICAgICByZXN1bHRbJ3JlcXVlc3RDb3VudCddID0gMDtcbiAgICB9XG5cbiAgICB2YXIgbWFya1N0YXJ0RXZlbnQgPSBudWxsO1xuICAgIHZhciBtYXJrRW5kRXZlbnQgPSBudWxsO1xuICAgIHZhciBnY1RpbWVJblNjcmlwdCA9IDA7XG4gICAgdmFyIHJlbmRlclRpbWVJblNjcmlwdCA9IDA7XG5cbiAgICB2YXIgZnJhbWVUaW1lc3RhbXBzID0gW107XG4gICAgdmFyIGZyYW1lVGltZXMgPSBbXTtcbiAgICB2YXIgZnJhbWVDYXB0dXJlU3RhcnRFdmVudCA9IG51bGw7XG4gICAgdmFyIGZyYW1lQ2FwdHVyZUVuZEV2ZW50ID0gbnVsbDtcblxuICAgIHZhciBpbnRlcnZhbFN0YXJ0czoge1trZXk6IHN0cmluZ106IGFueX0gPSB7fTtcbiAgICB2YXIgaW50ZXJ2YWxTdGFydENvdW50OiB7W2tleTogc3RyaW5nXTogbnVtYmVyfSA9IHt9O1xuICAgIGV2ZW50cy5mb3JFYWNoKChldmVudCkgPT4ge1xuICAgICAgdmFyIHBoID0gZXZlbnRbJ3BoJ107XG4gICAgICB2YXIgbmFtZSA9IGV2ZW50WyduYW1lJ107XG4gICAgICB2YXIgbWljcm9JdGVyYXRpb25zID0gMTtcbiAgICAgIHZhciBtaWNyb0l0ZXJhdGlvbnNNYXRjaCA9IFJlZ0V4cFdyYXBwZXIuZmlyc3RNYXRjaChfTUlDUk9fSVRFUkFUSU9OU19SRUdFWCwgbmFtZSk7XG4gICAgICBpZiAoaXNQcmVzZW50KG1pY3JvSXRlcmF0aW9uc01hdGNoKSkge1xuICAgICAgICBuYW1lID0gbWljcm9JdGVyYXRpb25zTWF0Y2hbMV07XG4gICAgICAgIG1pY3JvSXRlcmF0aW9ucyA9IE51bWJlcldyYXBwZXIucGFyc2VJbnQobWljcm9JdGVyYXRpb25zTWF0Y2hbMl0sIDEwKTtcbiAgICAgIH1cblxuICAgICAgaWYgKFN0cmluZ1dyYXBwZXIuZXF1YWxzKHBoLCAnYicpICYmIFN0cmluZ1dyYXBwZXIuZXF1YWxzKG5hbWUsIG1hcmtOYW1lKSkge1xuICAgICAgICBtYXJrU3RhcnRFdmVudCA9IGV2ZW50O1xuICAgICAgfSBlbHNlIGlmIChTdHJpbmdXcmFwcGVyLmVxdWFscyhwaCwgJ2UnKSAmJiBTdHJpbmdXcmFwcGVyLmVxdWFscyhuYW1lLCBtYXJrTmFtZSkpIHtcbiAgICAgICAgbWFya0VuZEV2ZW50ID0gZXZlbnQ7XG4gICAgICB9XG5cbiAgICAgIGxldCBpc0luc3RhbnQgPSBTdHJpbmdXcmFwcGVyLmVxdWFscyhwaCwgJ0knKSB8fCBTdHJpbmdXcmFwcGVyLmVxdWFscyhwaCwgJ2knKTtcbiAgICAgIGlmICh0aGlzLl9yZXF1ZXN0Q291bnQgJiYgU3RyaW5nV3JhcHBlci5lcXVhbHMobmFtZSwgJ3NlbmRSZXF1ZXN0JykpIHtcbiAgICAgICAgcmVzdWx0WydyZXF1ZXN0Q291bnQnXSArPSAxO1xuICAgICAgfSBlbHNlIGlmICh0aGlzLl9yZWNlaXZlZERhdGEgJiYgU3RyaW5nV3JhcHBlci5lcXVhbHMobmFtZSwgJ3JlY2VpdmVkRGF0YScpICYmIGlzSW5zdGFudCkge1xuICAgICAgICByZXN1bHRbJ3JlY2VpdmVkRGF0YSddICs9IGV2ZW50WydhcmdzJ11bJ2VuY29kZWREYXRhTGVuZ3RoJ107XG4gICAgICB9IGVsc2UgaWYgKFN0cmluZ1dyYXBwZXIuZXF1YWxzKG5hbWUsICduYXZpZ2F0aW9uU3RhcnQnKSkge1xuICAgICAgICAvLyBXZSBjb3VudCBkYXRhICsgcmVxdWVzdHMgc2luY2UgdGhlIGxhc3QgbmF2aWdhdGlvblN0YXJ0XG4gICAgICAgIC8vICh0aGVyZSBtaWdodCBiZSBjaHJvbWUgZXh0ZW5zaW9ucyBsb2FkZWQgYnkgc2VsZW5pdW0gYmVmb3JlIG91ciBwYWdlLCBzbyB0aGVyZVxuICAgICAgICAvLyB3aWxsIGxpa2VseSBiZSBtb3JlIHRoYW4gb25lIG5hdmlnYXRpb25TdGFydCkuXG4gICAgICAgIGlmICh0aGlzLl9yZWNlaXZlZERhdGEpIHtcbiAgICAgICAgICByZXN1bHRbJ3JlY2VpdmVkRGF0YSddID0gMDtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5fcmVxdWVzdENvdW50KSB7XG4gICAgICAgICAgcmVzdWx0WydyZXF1ZXN0Q291bnQnXSA9IDA7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmIChpc1ByZXNlbnQobWFya1N0YXJ0RXZlbnQpICYmIGlzQmxhbmsobWFya0VuZEV2ZW50KSAmJlxuICAgICAgICAgIGV2ZW50WydwaWQnXSA9PT0gbWFya1N0YXJ0RXZlbnRbJ3BpZCddKSB7XG4gICAgICAgIGlmIChTdHJpbmdXcmFwcGVyLmVxdWFscyhwaCwgJ2InKSAmJiBTdHJpbmdXcmFwcGVyLmVxdWFscyhuYW1lLCBfTUFSS19OQU1FX0ZSQU1FX0NBUFVUUkUpKSB7XG4gICAgICAgICAgaWYgKGlzUHJlc2VudChmcmFtZUNhcHR1cmVTdGFydEV2ZW50KSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEJhc2VFeGNlcHRpb24oJ2NhbiBjYXB0dXJlIGZyYW1lcyBvbmx5IG9uY2UgcGVyIGJlbmNobWFyayBydW4nKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKCF0aGlzLl9jYXB0dXJlRnJhbWVzKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgQmFzZUV4Y2VwdGlvbihcbiAgICAgICAgICAgICAgICAnZm91bmQgc3RhcnQgZXZlbnQgZm9yIGZyYW1lIGNhcHR1cmUsIGJ1dCBmcmFtZSBjYXB0dXJlIHdhcyBub3QgcmVxdWVzdGVkIGluIGJlbmNocHJlc3MnKVxuICAgICAgICAgIH1cbiAgICAgICAgICBmcmFtZUNhcHR1cmVTdGFydEV2ZW50ID0gZXZlbnQ7XG4gICAgICAgIH0gZWxzZSBpZiAoU3RyaW5nV3JhcHBlci5lcXVhbHMocGgsICdlJykgJiZcbiAgICAgICAgICAgICAgICAgICBTdHJpbmdXcmFwcGVyLmVxdWFscyhuYW1lLCBfTUFSS19OQU1FX0ZSQU1FX0NBUFVUUkUpKSB7XG4gICAgICAgICAgaWYgKGlzQmxhbmsoZnJhbWVDYXB0dXJlU3RhcnRFdmVudCkpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBCYXNlRXhjZXB0aW9uKCdtaXNzaW5nIHN0YXJ0IGV2ZW50IGZvciBmcmFtZSBjYXB0dXJlJyk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGZyYW1lQ2FwdHVyZUVuZEV2ZW50ID0gZXZlbnQ7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoaXNJbnN0YW50KSB7XG4gICAgICAgICAgaWYgKGlzUHJlc2VudChmcmFtZUNhcHR1cmVTdGFydEV2ZW50KSAmJiBpc0JsYW5rKGZyYW1lQ2FwdHVyZUVuZEV2ZW50KSAmJlxuICAgICAgICAgICAgICBTdHJpbmdXcmFwcGVyLmVxdWFscyhuYW1lLCAnZnJhbWUnKSkge1xuICAgICAgICAgICAgZnJhbWVUaW1lc3RhbXBzLnB1c2goZXZlbnRbJ3RzJ10pO1xuICAgICAgICAgICAgaWYgKGZyYW1lVGltZXN0YW1wcy5sZW5ndGggPj0gMikge1xuICAgICAgICAgICAgICBmcmFtZVRpbWVzLnB1c2goZnJhbWVUaW1lc3RhbXBzW2ZyYW1lVGltZXN0YW1wcy5sZW5ndGggLSAxXSAtXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmcmFtZVRpbWVzdGFtcHNbZnJhbWVUaW1lc3RhbXBzLmxlbmd0aCAtIDJdKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoU3RyaW5nV3JhcHBlci5lcXVhbHMocGgsICdCJykgfHwgU3RyaW5nV3JhcHBlci5lcXVhbHMocGgsICdiJykpIHtcbiAgICAgICAgICBpZiAoaXNCbGFuayhpbnRlcnZhbFN0YXJ0c1tuYW1lXSkpIHtcbiAgICAgICAgICAgIGludGVydmFsU3RhcnRDb3VudFtuYW1lXSA9IDE7XG4gICAgICAgICAgICBpbnRlcnZhbFN0YXJ0c1tuYW1lXSA9IGV2ZW50O1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpbnRlcnZhbFN0YXJ0Q291bnRbbmFtZV0rKztcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAoKFN0cmluZ1dyYXBwZXIuZXF1YWxzKHBoLCAnRScpIHx8IFN0cmluZ1dyYXBwZXIuZXF1YWxzKHBoLCAnZScpKSAmJlxuICAgICAgICAgICAgICAgICAgIGlzUHJlc2VudChpbnRlcnZhbFN0YXJ0c1tuYW1lXSkpIHtcbiAgICAgICAgICBpbnRlcnZhbFN0YXJ0Q291bnRbbmFtZV0tLTtcbiAgICAgICAgICBpZiAoaW50ZXJ2YWxTdGFydENvdW50W25hbWVdID09PSAwKSB7XG4gICAgICAgICAgICB2YXIgc3RhcnRFdmVudCA9IGludGVydmFsU3RhcnRzW25hbWVdO1xuICAgICAgICAgICAgdmFyIGR1cmF0aW9uID0gKGV2ZW50Wyd0cyddIC0gc3RhcnRFdmVudFsndHMnXSk7XG4gICAgICAgICAgICBpbnRlcnZhbFN0YXJ0c1tuYW1lXSA9IG51bGw7XG4gICAgICAgICAgICBpZiAoU3RyaW5nV3JhcHBlci5lcXVhbHMobmFtZSwgJ2djJykpIHtcbiAgICAgICAgICAgICAgcmVzdWx0WydnY1RpbWUnXSArPSBkdXJhdGlvbjtcbiAgICAgICAgICAgICAgdmFyIGFtb3VudCA9XG4gICAgICAgICAgICAgICAgICAoc3RhcnRFdmVudFsnYXJncyddWyd1c2VkSGVhcFNpemUnXSAtIGV2ZW50WydhcmdzJ11bJ3VzZWRIZWFwU2l6ZSddKSAvIDEwMDA7XG4gICAgICAgICAgICAgIHJlc3VsdFsnZ2NBbW91bnQnXSArPSBhbW91bnQ7XG4gICAgICAgICAgICAgIHZhciBtYWpvckdjID0gZXZlbnRbJ2FyZ3MnXVsnbWFqb3JHYyddO1xuICAgICAgICAgICAgICBpZiAoaXNQcmVzZW50KG1ham9yR2MpICYmIG1ham9yR2MpIHtcbiAgICAgICAgICAgICAgICByZXN1bHRbJ21ham9yR2NUaW1lJ10gKz0gZHVyYXRpb247XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgaWYgKGlzUHJlc2VudChpbnRlcnZhbFN0YXJ0c1snc2NyaXB0J10pKSB7XG4gICAgICAgICAgICAgICAgZ2NUaW1lSW5TY3JpcHQgKz0gZHVyYXRpb247XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSBpZiAoU3RyaW5nV3JhcHBlci5lcXVhbHMobmFtZSwgJ3JlbmRlcicpKSB7XG4gICAgICAgICAgICAgIHJlc3VsdFsncmVuZGVyVGltZSddICs9IGR1cmF0aW9uO1xuICAgICAgICAgICAgICBpZiAoaXNQcmVzZW50KGludGVydmFsU3RhcnRzWydzY3JpcHQnXSkpIHtcbiAgICAgICAgICAgICAgICByZW5kZXJUaW1lSW5TY3JpcHQgKz0gZHVyYXRpb247XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSBpZiAoU3RyaW5nV3JhcHBlci5lcXVhbHMobmFtZSwgJ3NjcmlwdCcpKSB7XG4gICAgICAgICAgICAgIHJlc3VsdFsnc2NyaXB0VGltZSddICs9IGR1cmF0aW9uO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChpc1ByZXNlbnQodGhpcy5fbWljcm9NZXRyaWNzW25hbWVdKSkge1xuICAgICAgICAgICAgICByZXN1bHRbbmFtZV0gKz0gZHVyYXRpb24gLyBtaWNyb0l0ZXJhdGlvbnM7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gICAgaWYgKCFpc1ByZXNlbnQobWFya1N0YXJ0RXZlbnQpIHx8ICFpc1ByZXNlbnQobWFya0VuZEV2ZW50KSkge1xuICAgICAgLy8gbm90IGFsbCBldmVudHMgaGF2ZSBiZWVuIHJlY2VpdmVkLCBubyBmdXJ0aGVyIHByb2Nlc3NpbmcgZm9yIG5vd1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgaWYgKGlzUHJlc2VudChtYXJrRW5kRXZlbnQpICYmIGlzUHJlc2VudChmcmFtZUNhcHR1cmVTdGFydEV2ZW50KSAmJlxuICAgICAgICBpc0JsYW5rKGZyYW1lQ2FwdHVyZUVuZEV2ZW50KSkge1xuICAgICAgdGhyb3cgbmV3IEJhc2VFeGNlcHRpb24oJ21pc3NpbmcgZW5kIGV2ZW50IGZvciBmcmFtZSBjYXB0dXJlJyk7XG4gICAgfVxuICAgIGlmICh0aGlzLl9jYXB0dXJlRnJhbWVzICYmIGlzQmxhbmsoZnJhbWVDYXB0dXJlU3RhcnRFdmVudCkpIHtcbiAgICAgIHRocm93IG5ldyBCYXNlRXhjZXB0aW9uKFxuICAgICAgICAgICdmcmFtZSBjYXB0dXJlIHJlcXVlc3RlZCBpbiBiZW5jaHByZXNzLCBidXQgbm8gc3RhcnQgZXZlbnQgd2FzIGZvdW5kJyk7XG4gICAgfVxuICAgIGlmIChmcmFtZVRpbWVzLmxlbmd0aCA+IDApIHtcbiAgICAgIHRoaXMuX2FkZEZyYW1lTWV0cmljcyhyZXN1bHQsIGZyYW1lVGltZXMpO1xuICAgIH1cbiAgICByZXN1bHRbJ3B1cmVTY3JpcHRUaW1lJ10gPSByZXN1bHRbJ3NjcmlwdFRpbWUnXSAtIGdjVGltZUluU2NyaXB0IC0gcmVuZGVyVGltZUluU2NyaXB0O1xuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICBfYWRkRnJhbWVNZXRyaWNzKHJlc3VsdDoge1trZXk6IHN0cmluZ106IGFueX0sIGZyYW1lVGltZXM6IGFueVtdKSB7XG4gICAgcmVzdWx0WydmcmFtZVRpbWUubWVhbiddID0gZnJhbWVUaW1lcy5yZWR1Y2UoKGEsIGIpID0+IGEgKyBiLCAwKSAvIGZyYW1lVGltZXMubGVuZ3RoO1xuICAgIHZhciBmaXJzdEZyYW1lID0gZnJhbWVUaW1lc1swXTtcbiAgICByZXN1bHRbJ2ZyYW1lVGltZS53b3JzdCddID0gZnJhbWVUaW1lcy5yZWR1Y2UoKGEsIGIpID0+IGEgPiBiID8gYSA6IGIsIGZpcnN0RnJhbWUpO1xuICAgIHJlc3VsdFsnZnJhbWVUaW1lLmJlc3QnXSA9IGZyYW1lVGltZXMucmVkdWNlKChhLCBiKSA9PiBhIDwgYiA/IGEgOiBiLCBmaXJzdEZyYW1lKTtcbiAgICByZXN1bHRbJ2ZyYW1lVGltZS5zbW9vdGgnXSA9XG4gICAgICAgIGZyYW1lVGltZXMuZmlsdGVyKHQgPT4gdCA8IF9GUkFNRV9USU1FX1NNT09USF9USFJFU0hPTEQpLmxlbmd0aCAvIGZyYW1lVGltZXMubGVuZ3RoO1xuICB9XG5cbiAgX21hcmtOYW1lKGluZGV4KSB7IHJldHVybiBgJHtfTUFSS19OQU1FX1BSRUZJWH0ke2luZGV4fWA7IH1cbn1cblxudmFyIF9NSUNST19JVEVSQVRJT05TX1JFR0VYID0gLyguKylcXCooXFxkKykkL2c7XG5cbnZhciBfTUFYX1JFVFJZX0NPVU5UID0gMjA7XG52YXIgX01BUktfTkFNRV9QUkVGSVggPSAnYmVuY2hwcmVzcyc7XG52YXIgX1NFVF9USU1FT1VUID0gbmV3IE9wYXF1ZVRva2VuKCdQZXJmbG9nTWV0cmljLnNldFRpbWVvdXQnKTtcblxudmFyIF9NQVJLX05BTUVfRlJBTUVfQ0FQVVRSRSA9ICdmcmFtZUNhcHR1cmUnO1xuLy8gdXNpbmcgMTdtcyBhcyBhIHNvbWV3aGF0IGxvb3NlciB0aHJlc2hvbGQsIGluc3RlYWQgb2YgMTYuNjY2Nm1zXG52YXIgX0ZSQU1FX1RJTUVfU01PT1RIX1RIUkVTSE9MRCA9IDE3O1xuXG52YXIgX1BST1ZJREVSUyA9IFtcbiAgYmluZChQZXJmbG9nTWV0cmljKVxuICAgICAgLnRvRmFjdG9yeShcbiAgICAgICAgICAoZHJpdmVyRXh0ZW5zaW9uLCBzZXRUaW1lb3V0LCBtaWNyb01ldHJpY3MsIGZvcmNlR2MsIGNhcHR1cmVGcmFtZXMsIHJlY2VpdmVkRGF0YSxcbiAgICAgICAgICAgcmVxdWVzdENvdW50KSA9PiBuZXcgUGVyZmxvZ01ldHJpYyhkcml2ZXJFeHRlbnNpb24sIHNldFRpbWVvdXQsIG1pY3JvTWV0cmljcywgZm9yY2VHYyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXB0dXJlRnJhbWVzLCByZWNlaXZlZERhdGEsIHJlcXVlc3RDb3VudCksXG4gICAgICAgICAgW1xuICAgICAgICAgICAgV2ViRHJpdmVyRXh0ZW5zaW9uLFxuICAgICAgICAgICAgX1NFVF9USU1FT1VULFxuICAgICAgICAgICAgT3B0aW9ucy5NSUNST19NRVRSSUNTLFxuICAgICAgICAgICAgT3B0aW9ucy5GT1JDRV9HQyxcbiAgICAgICAgICAgIE9wdGlvbnMuQ0FQVFVSRV9GUkFNRVMsXG4gICAgICAgICAgICBPcHRpb25zLlJFQ0VJVkVEX0RBVEEsXG4gICAgICAgICAgICBPcHRpb25zLlJFUVVFU1RfQ09VTlRcbiAgICAgICAgICBdKSxcbiAgcHJvdmlkZShfU0VUX1RJTUVPVVQsIHt1c2VWYWx1ZTogKGZuLCBtaWxsaXMpID0+IFRpbWVyV3JhcHBlci5zZXRUaW1lb3V0KGZuLCBtaWxsaXMpfSlcbl07XG4iXX0=